<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transylvania Blood Network</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Cinzel Decorative", serif;
        background-color: #0d0d0d;
        color: #f5f5f5;
        overflow-x: hidden;
        position: relative;
        background-image: url("https://images.unsplash.com/photo-1542848906-8809e6c38b25?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      }

      /* Overlay to darken the background image */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: -1;
      }

      /* NEW: Initial Welcome Overlay Styles */
      #initial-welcome-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        color: #f5f5f5;
        text-align: center;
        opacity: 1;
        transition: opacity 1s ease-in-out;
      }

      #initial-welcome-overlay.hidden {
        opacity: 0;
        pointer-events: none; /* Make it unclickable when hidden */
      }

      .welcome-image {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 20px;
        border: 3px solid #e60000;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.7);
      }

      #initial-welcome-overlay h2 {
        font-family: "Cinzel Decorative", serif;
        font-size: 2.5em;
        color: #e60000;
        margin-bottom: 10px;
        text-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
      }

      #initial-welcome-overlay p {
        font-family: "Dancing Script", cursive;
        font-size: 1.5em;
        margin-bottom: 30px;
      }

      #enter-site-button {
        padding: 15px 30px;
        font-size: 1.2em;
        background-color: #e60000;
        color: #f5f5f5;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 5px 15px rgba(255, 0, 0, 0.5);
      }

      #enter-site-button:hover {
        background-color: #cc0000;
        transform: scale(1.05);
      }

      /* END: Initial Welcome Overlay Styles */

      header {
        background-color: rgba(13, 13, 13, 0.9);
        color: #e60000;
        padding: 15px 0;
        text-align: center;
        border-bottom: 2px solid #550000;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      }

      header h1 {
        margin: 0;
        font-size: 2.8em;
        font-family: "Cinzel Decorative", serif;
        text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
      }

      nav {
        background-color: rgba(26, 26, 26, 0.9);
        padding: 10px 0;
        text-align: center;
        border-bottom: 1px solid #550000;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      .nav-row {
        display: flex;
        justify-content: center;
        flex-wrap: wrap; /* Allows items to wrap on smaller screens */
        margin-bottom: 5px; /* Space between rows if wrapped */
      }

      nav a {
        color: #f5f5f5;
        text-decoration: none;
        margin: 0 15px;
        font-size: 1.1em;
        padding: 5px 0;
        position: relative;
        transition: color 0.3s ease;
      }

      nav a i {
        margin-right: 10px;
        color: #e60000;
      }

      nav a::after {
        content: "";
        position: absolute;
        width: 0;
        height: 2px;
        display: block;
        margin-top: 5px;
        right: 0;
        background: #e60000;
        transition: width 0.3s ease;
      }

      nav a:hover::after {
        width: 100%;
        left: 0;
        background: #e60000;
      }

      nav a:hover {
        color: #e60000;
      }

      section {
        background-color: rgba(26, 26, 26, 0.85);
        margin: 40px auto;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        max-width: 900px;
        border: 1px solid #550000;
        position: relative;
        overflow: hidden; /* For inner elements like form animations */
      }

      section h2 {
        font-family: "Cinzel Decorative", serif;
        color: #e60000;
        text-align: center;
        margin-bottom: 25px;
        font-size: 2.2em;
        text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
      }

      /* Bat animation */
      .bat-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 50;
        overflow: hidden;
      }

      .bat {
        position: absolute;
        width: 80px;
        height: auto;
        animation-timing-function: linear;
        transform: scaleX(1); /* Default direction (right) */
        filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.7));
      }

      @keyframes flyToRight {
        0% {
          left: -80px;
          transform: translateY(var(--startY)) scaleX(1);
        }
        50% {
          transform: translateX(calc(50vw + var(--midY) / 2))
            translateY(calc(var(--startY) / 2 + var(--endY) / 2)) scaleX(1);
        }
        100% {
          left: 100%;
          transform: translateY(var(--endY)) scaleX(1);
        }
      }

      @keyframes flyToLeft {
        0% {
          left: 100%;
          transform: translateY(var(--startY)) scaleX(-1);
        }
        50% {
          transform: translateX(calc(-50vw - var(--midY) / 2))
            translateY(calc(var(--startY) / 2 + var(--endY) / 2)) scaleX(-1);
        }
        100% {
          left: -80px;
          transform: translateY(var(--endY)) scaleX(-1);
        }
      }

      /* Blood drip on click */
      .blood-drop {
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: #e60000;
        border-radius: 50%;
        transform: scale(0);
        animation: drip 0.8s ease-out forwards;
        z-index: 200;
        filter: drop-shadow(0 0 8px rgba(255, 0, 0, 0.7));
      }

      @keyframes drip {
        0% {
          transform: scale(0);
          opacity: 1;
        }
        50% {
          transform: scale(1);
          opacity: 1;
        }
        100% {
          transform: scale(0.5);
          opacity: 0;
          margin-top: 50px; /* Fall effect */
        }
      }

      /* Mist effect on scroll */
      .mist-overlay {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 0; /* Starts hidden */
        background: linear-gradient(
          to top,
          rgba(139, 0, 0, 0.5),
          transparent
        ); /* Dark red fading upwards */
        z-index: 10;
        pointer-events: none;
        transition: height 0.3s ease-out, opacity 0.3s ease-out;
        opacity: 0;
      }

      /* Mouse Glow */
      #mouse-glow {
        position: fixed;
        width: 80px;
        height: 80px;
        background: radial-gradient(
          circle,
          rgba(255, 0, 0, 0.4) 0%,
          transparent 70%
        );
        border-radius: 50%;
        pointer-events: none;
        transform: translate(-50%, -50%);
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.1s ease-out;
        filter: blur(5px);
      }

      /* Form styles */
      .form-group {
        margin-bottom: 20px;
      }

      form label {
        display: block;
        margin-bottom: 8px;
        color: #e60000;
        font-weight: bold;
        font-size: 1.1em;
      }

      form input[type="text"],
      form input[type="email"],
      form select,
      form textarea {
        width: calc(100% - 20px);
        padding: 12px;
        margin-bottom: 15px;
        border: 1px solid #550000;
        border-radius: 5px;
        background-color: #0d0d0d;
        color: #f5f5f5;
        font-size: 1em;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }

      form input[type="text"]:focus,
      form input[type="email"]:focus,
      form select:focus,
      form textarea:focus {
        border-color: #e60000;
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        outline: none;
      }

      form textarea {
        resize: vertical;
        min-height: 100px;
      }

      form button[type="submit"] {
        background-color: #e60000;
        color: #f5f5f5;
        padding: 12px 25px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1.1em;
        transition: background-color 0.3s ease, transform 0.2s ease;
        display: block;
        margin: 20px auto 0;
      }

      form button[type="submit"]:hover {
        background-color: #cc0000;
        transform: scale(1.03);
      }

      .success-message {
        color: #00ff00;
        text-align: center;
        margin-top: 15px;
        font-weight: bold;
      }

      /* Donor list and inventory */
      #donors-section ul {
        list-style: none;
        padding: 0;
      }

      #donors-section ul li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: rgba(0, 0, 0, 0.4);
        margin-bottom: 8px;
        padding: 10px 15px;
        border-radius: 5px;
        border: 1px solid #330000;
      }

      #donors-section ul li span {
        font-size: 1.1em;
        color: #f5f5f5;
      }

      #donors-section ul li button,
      #clear-donors-button {
        background-color: #770000;
        color: #f5f5f5;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        font-size: 0.9em;
        margin-left: 10px; /* Space between text and button */
      }

      #donors-section ul li button:hover,
      #clear-donors-button:hover {
        background-color: #990000;
      }

      #clear-donors-button {
        display: block;
        margin: 20px auto 0;
        font-size: 1em;
        padding: 10px 20px;
        background-color: #a00000;
      }
      #clear-donors-button:hover {
        background-color: #cc0000;
      }

      #no-donors-message {
        text-align: center;
        color: #aaa;
        font-style: italic;
        margin-top: 15px;
      }

      #inventory-summary {
        margin-top: 25px;
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.4);
        border: 1px solid #330000;
        border-radius: 5px;
        font-size: 1.1em;
        color: #f5f5f5;
        line-height: 1.6;
        text-align: center;
      }

      /* Letter section */
      #letter #output {
        white-space: pre-wrap; /* Preserve whitespace and line breaks */
        font-family: "Dancing Script", cursive;
        font-size: 1.4em;
        color: #f5f5f5;
        line-height: 1.8;
        background-color: rgba(0, 0, 0, 0.6);
        padding: 25px;
        border-radius: 8px;
        border: 1px solid #550000;
        box-shadow: inset 0 0 10px rgba(255, 0, 0, 0.3);
        max-height: 600px; /* Limit height */
        overflow-y: auto; /* Enable scrolling if content exceeds height */
      }

      /* Typing cursor effect */
      .typing-cursor::after {
        content: "|";
        animation: blink-caret 0.75s step-end infinite;
      }

      @keyframes blink-caret {
        from,
        to {
          border-color: transparent;
        }
        50% {
          border-color: #e60000;
        }
      }

      /* Facts & Cravings section */
      .fact-craving-container {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      .fact-box,
      .craving-box {
        background-color: rgba(0, 0, 0, 0.4);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #330000;
        text-align: center;
        flex: 1; /* Allow boxes to grow */
      }

      .fact-box p,
      .craving-box p {
        font-family: "Dancing Script", cursive;
        font-size: 1.2em;
        color: #f5f5f5;
        margin-bottom: 15px;
        min-height: 50px; /* Ensure consistent height for output */
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .fact-box button,
      .craving-box select,
      .craving-box button {
        padding: 10px 20px;
        font-size: 1em;
        background-color: #e60000;
        color: #f5f5f5;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .fact-box button:hover,
      .craving-box button:hover {
        background-color: #cc0000;
      }

      .craving-box select {
        width: calc(100% - 40px);
        margin-bottom: 15px;
      }

      /* Game section */
      #game-area {
        position: relative;
        width: 100%;
        max-width: 800px;
        height: 400px;
        background-color: rgba(0, 0, 0, 0.6);
        border: 2px solid #e60000;
        border-radius: 10px;
        margin: 20px auto;
        overflow: hidden;
        cursor: url("claw-cursor.png") 16 16, auto; /* Custom cursor */
      }

      .game-info {
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
        font-size: 1.2em;
        color: #e60000;
        font-weight: bold;
      }

      .game-bat {
        position: absolute;
        width: 80px;
        height: auto;
        cursor: pointer;
        transition: transform 0.1s ease-out; /* For click effect */
      }

      .game-bat:active {
        transform: scale(0.9);
      }

      #game-start-button {
        display: block;
        margin: 20px auto 0;
        padding: 15px 30px;
        font-size: 1.2em;
        background-color: #e60000;
        color: #f5f5f5;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
      }

      #game-start-button:hover:not(:disabled) {
        background-color: #cc0000;
        transform: scale(1.03);
      }

      #game-start-button.disabled {
        background-color: #555;
        cursor: not-allowed;
      }

      /* Sound Toggle Button */
      #sound-toggle-button {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 60px;
        height: 60px;
        background-color: rgba(230, 0, 0, 0.7);
        border: none;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
        z-index: 1000;
        transition: background-color 0.3s ease;
      }

      #sound-toggle-button:hover {
        background-color: rgba(204, 0, 0, 0.9);
      }

      #sound-toggle-button img {
        width: 70%;
        height: 70%;
        object-fit: contain;
      }

      #sound-off-icon {
        display: none; /* Hidden by default */
      }

      /* Footer */
      footer {
        text-align: center;
        padding: 20px;
        background-color: rgba(13, 13, 13, 0.9);
        color: #aaa;
        border-top: 1px solid #550000;
        margin-top: 50px;
        font-size: 0.9em;
      }

      footer p {
        margin: 5px 0;
      }

      footer a {
        color: #e60000;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      footer a:hover {
        color: #ff3333;
      }

      /* Responsive Adjustments */
      @media (max-width: 768px) {
        header h1 {
          font-size: 2em;
        }

        nav a {
          margin: 0 10px;
          font-size: 1em;
        }

        section {
          margin: 30px 15px;
          padding: 20px;
        }

        section h2 {
          font-size: 1.8em;
        }

        form input[type="text"],
        form input[type="email"],
        form select,
        form textarea {
          width: calc(100% - 20px);
        }

        .fact-craving-container {
          flex-direction: column;
        }

        #game-area {
          height: 300px;
          width: calc(100% - 20px); /* Adjust for padding */
        }

        .game-bat {
          width: 60px;
        }

        #initial-welcome-overlay h2 {
          font-size: 1.8em;
        }

        #initial-welcome-overlay p {
          font-size: 1.2em;
        }

        #enter-site-button {
          padding: 12px 25px;
          font-size: 1em;
        }

        #sound-toggle-button {
          width: 50px;
          height: 50px;
          bottom: 10px;
          left: 10px;
        }

        /* MODIFICĂRI RESPONSIVE PENTRU NAVIGARE AICI */
        nav {
          top: 60px; /* Ajustează poziția sticky dacă headerul e mai mic */
          padding: 8px 0; /* Padding redus */
        }

        nav a {
          margin: 0 8px; /* Spațiu mai mic între link-uri */
          font-size: 0.9em; /* Font mai mic */
          padding: 3px 0;
        }

        nav a i {
          margin-right: 5px; /* Spațiu mai mic între iconiță și text */
          font-size: 1em; /* Iconiță mai mică */
        }

        .nav-row {
          margin-bottom: 3px; /* Spațiu redus între rânduri */
        }
        /* SFÂRȘIT MODIFICĂRI RESPONSIVE PENTRU NAVIGARE */

        section {
          padding: 20px;
          margin: 20px auto;
        }

        #sound-toggle-button {
          width: 50px;
          height: 50px;
          bottom: 10px;
          left: 10px;
        }

        #sound-toggle-button img {
          width: 70%;
          height: 70%;
        }
      }

      /* Styles for Donation Confirmation Box */
      .confirmation-box {
          position: fixed;
          bottom: 20px;
          right: 20px;
          background-color: rgba(0, 128, 0, 0.8);
          color: #f5f5f5;
          padding: 15px 25px;
          border-radius: 8px;
          box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
          z-index: 1000;
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
      }

      .confirmation-box.show {
          opacity: 1;
          visibility: visible;
      }

      /* Styles for Countdown Section */
      #countdown-section {
          text-align: center;
      }

      .countdown-timer {
          display: flex;
          justify-content: center;
          gap: 20px;
          margin-top: 20px;
          margin-bottom: 20px;
          flex-wrap: wrap; /* Allow wrapping on smaller screens */
      }

      .countdown-timer div {
          background-color: rgba(42, 42, 42, 0.7);
          padding: 15px 20px;
          border-radius: 8px;
          border: 1px solid #e60000;
          box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
          text-align: center;
          min-width: 80px; /* Ensure some minimum width */
      }

      .countdown-timer span {
          display: block;
          font-size: 2.5em;
          color: #e60000;
          font-weight: bold;
          text-shadow: 0 0 8px rgba(255, 0, 0, 0.7);
      }

      .countdown-timer div:last-child span {
          font-size: 2.5em; /* Ensure consistent font size */
      }

      .countdown-message {
          font-family: "Dancing Script", cursive;
          font-size: 1.3em;
          color: #ccc;
          margin-top: 15px;
      }

      .countdown-message.countdown-finished {
          color: #00ff00; /* Green color for completion */
          font-weight: bold;
          text-shadow: 0 0 10px rgba(0, 255, 0, 0.7);
      }

      /* Quiz specific styles for feedback and results */
      .quiz-feedback {
          margin-top: 15px;
          font-weight: bold;
          text-align: center;
          padding: 10px;
          border-radius: 5px;
          background-color: rgba(0, 0, 0, 0.5);
          display: none; /* Hidden by default */
      }

      .quiz-result {
          margin-top: 20px;
          font-size: 1.5em;
          font-weight: bold;
          color: #e60000;
          text-align: center;
          display: none; /* Hidden by default */
      }

      .quiz-button {
          margin-top: 20px;
          padding: 12px 25px;
          font-size: 1.1em;
          cursor: pointer;
          background-color: #e60000;
          color: #f5f5f5;
          border: none;
          border-radius: 5px;
          transition: background-color 0.3s ease;
      }

      .quiz-button:hover {
          background-color: #cc0000;
      }

      .quiz-button:disabled {
          background-color: #555;
          cursor: not-allowed;
      }
    </style>
  </head>

  <body>
    <div id="initial-welcome-overlay">
      <img src="dracula.jpeg" alt="Dracula Welcome" class="welcome-image" />
      <h2>Welcome to the Transylvania Blood Network.</h2>
      <p>Prepare to delve into the shadows...</p>
      <button id="enter-site-button">Enter at Your Own Risk</button>
    </div>

    <div id="bat-container"></div>
    <div id="mouse-glow"></div>
    <div class="mist-overlay" id="mist-overlay"></div>

    <audio id="bat-sound" loop preload="auto">
      <source src="bat-screech.mp3" type="audio/mpeg" />
      Your browser does not support the audio element.
    </audio>
    <audio id="drip-sound" preload="auto">
      <source src="drip.mp3" type="audio/mpeg" />
      Your browser does not support the audio element.
    </audio>
    <audio id="chime-sound" preload="auto">
      <source src="chime.mp3" type="audio/mpeg" />
      Your browser does not support the audio element.
    </audio>
    <audio id="typing-sound" preload="auto">
      <source src="typing-sound.mp3" type="audio/mpeg" />
      Your browser does not support the audio element.
    </audio>
    <audio id="evil-laugh-sound" preload="auto">
      <source src="evil-laugh.mp3" type="audio/mpeg" />
      Your browser does not support the audio element.
    </audio>
    <audio id="wolf-howl-sound" preload="auto">
      <source src="wolf-howl.mp3" type="audio/mpeg" />
      Your browser does not support the audio element.
    </audio>

    <header>
      <h1>Transylvania Blood Network</h1>
    </header>

    <nav>
      <div class="nav-row">
        <a href="#register"><i class="fas fa-hand-holding-medical"></i>Register</a>
        <a href="#donors"><i class="fas fa-users"></i>Donors</a>
        <a href="#letter"><i class="fas fa-envelope"></i>Letter</a>
      </div>
      <div class="nav-row">
        <a href="#secrets"><i class="fas fa-hat-wizard"></i>Secrets</a>
        <a href="#game"><i class="fas fa-gamepad"></i>Game</a>
        <a href="#countdown-section"><i class="fas fa-clock"></i>Countdown</a>
      </div>
      <div class="nav-row">
        <a href="#vampire-quiz"><i class="fas fa-question-circle"></i>Quiz</a>
        <a href="#contact"><i class="fas fa-phone"></i>Contact</a>
        <a href="#about"><i class="fas fa-info-circle"></i>About</a>
      </div>
    </nav>

    <main>
      <section id="register">
        <h2>Register as a Donor</h2>
        <form id="donor-form">
          <div class="form-group">
            <label for="name">Your Name:</label>
            <input type="text" id="name" required placeholder="Enter your full name..." />
          </div>
          <div class="form-group">
            <label for="group">Blood Group:</label>
            <select id="group" required>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
          </div>
          <button type="button" onclick="submitDonor()">Submit</button>
        </form>
      </section>

      <section id="donors">
        <h2>Registered Donors & Blood Inventory</h2>
        <ul id="donor-list">
          </ul>
        <p id="no-donors-message">No donors registered yet. Be the first!</p>
        <button id="clear-donors-button" onclick="clearAllDonors()">Clear All Donors</button>
        <h3>Blood Inventory Summary:</h3>
        <p id="inventory-summary">Loading inventory...</p>
      </section>

      <section id="letter">
        <h2>Your Welcome Letter</h2>
        <div id="output">
          </div>
      </section>

      <section id="secrets">
        <h2>Transylvanian Secrets & Cravings</h2>
        <div class="fact-craving-container">
          <div class="fact-box">
            <h3>Vampire Fact of the Day</h3>
            <p id="vampire-fact-output">Click the button for a dark truth...</p>
            <button onclick="displayRandomVampireFact()">Reveal Fact</button>
          </div>
          <div class="craving-box">
            <h3>Your Blood Craving</h3>
            <label for="craving-group">Select Your Blood Group:</label>
            <select id="craving-group" onchange="getBloodCraving()">
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
            <p id="craving-output">Discover what your blood truly desires...</p>
          </div>
        </div>
      </section>

      <section id="game">
        <h2>Bat Catcher: Test Your Reflexes!</h2>
        <div class="game-info">
          <span id="score-display">Score: 0</span>
          <span id="timer-display">Time: 30s</span>
        </div>
        <div id="game-area">
          </div>
        <button id="game-start-button">Start Game</button>
      </section>

      <section id="countdown-section">
          <h2>Transformation Countdown</h2>
          <div id="countdown" class="countdown-timer">
              <div><span id="days">00</span>Days</div>
              <div><span id="hours">00</span>Hours</div>
              <div><span id="minutes">00</span>Minutes</div>
              <div><span id="seconds">00</span>Seconds</div>
          </div>
          <p id="countdown-message" class="countdown-message">
              Register as a donor to begin your mystical transformation countdown...
          </p>
          <button id="start-countdown-button" style="margin-top: 20px;">Start Demo Countdown</button>
      </section>

      <div id="donation-confirmation-box" class="confirmation-box">
          <p>Your blood is a gift. A new journey begins.</p>
      </div>

      <section id="vampire-quiz">
          <h2>Vampire Quiz: Are You One of Us?</h2>
          <div id="quiz-container">
              <div class="quiz-question" id="quiz-question"></div>
              <div class="quiz-options" id="quiz-options"></div>
              <div id="quiz-feedback" class="quiz-feedback"></div>
              <button id="next-button" class="quiz-button" style="display: none;">Next Question</button>
              <button id="submit-button" class="quiz-button" style="display: none;">Submit Quiz</button>
              <div id="quiz-result" class="quiz-result" style="display: none;"></div>
              <button id="retake-quiz-button" class="quiz-button" style="display: none;">Retake Quiz</button>
          </div>
      </section>

      <section id="contact">
        <h2>Contact Us</h2>
        <form>
          <label for="contact-name">Your Name</label>
          <input
            type="text"
            id="contact-name"
            placeholder="Enter your name..."
            required
          />

          <label for="contact-email">Your Email</label>
          <input
            type="email"
            id="contact-email"
            placeholder="Enter your email..."
            required
          />

          <label for="contact-message">Your Message</label>
          <textarea
            id="contact-message"
            placeholder="Type your message here..."
            required
          ></textarea>

          <button type="submit">Send Message</button>
          <div id="contact-success-message" class="success-message"></div>
        </form>
      </section>

      <section id="about">
        <h2>About</h2>
        <p>
          This web app was created in a 48h hackathon by a team of beginner
          developers from Romania. Inspired by our culture and humanity, we
          believe every drop tells a story. And perhaps, awakens something more
          primal within us all.
        </p>
      </section>
    </main>

    <button id="sound-toggle-button" aria-label="Toggle Sound">
      <img
        id="sound-off-icon"
        src="haut-parleur-rouge-et-icone-sonore.png"
        alt="Sound Off"
      />
      <img
        id="sound-on-icon"
        src="icone-du-son-et-du-haut-parleur-rouge.png"
        alt="Sound On"
      />
    </button>

    <script>
      // Initial Welcome Overlay
      document.addEventListener("DOMContentLoaded", () => {
        const initialWelcomeOverlay = document.getElementById(
          "initial-welcome-overlay"
        );
        const enterSiteButton = document.getElementById("enter-site-button");
        const batSound = document.getElementById("bat-sound"); // Assuming this is your background music

        // --- IMPORTANT MODIFICATION FOR SOUND BUTTON VISIBILITY AND INITIAL SOUND STATE ---
        const soundOnIcon = document.getElementById("sound-on-icon");
        const soundOffIcon = document.getElementById("sound-off-icon");

        // Initial state: sound is ON
        isSoundOn = true; // Set isSoundOn to true globally

        // Ensure that soundOnIcon is visible and soundOffIcon is hidden on initial load
        if (soundOnIcon) soundOnIcon.style.display = "block"; // Show sound ON icon
        if (soundOffIcon) soundOffIcon.style.display = "none"; // Hide sound OFF icon

        // Attempt to play background sound (batSound) immediately on DOM load
        // Modern browsers might still require user interaction, but this is the correct place to try
        if (batSound) {
          batSound.volume = 0.3; // Set initial volume
          batSound.play().catch((e) => {
            console.error("Audio play failed on initial load (might require user interaction):", e);
            // If autoplay fails, hide sound on icon and show sound off icon
            // and set isSoundOn to false, so the user knows sound is off and can click to enable
            if (soundOnIcon) soundOnIcon.style.display = "none";
            if (soundOffIcon) soundOffIcon.style.display = "block";
            isSoundOn = false; // Reflect actual state if autoplay fails
          });
        }
        // --- END OF IMPORTANT MODIFICATION ---


        enterSiteButton.addEventListener("click", () => {
          initialWelcomeOverlay.classList.add("hidden");
          // No need to play batSound here anymore, it's handled on DOMContentLoaded
        });

        // Initialize countdown and quiz when DOM is loaded
        // startDemoCountdown(); // This will be triggered by button click
        startQuiz(); // Start the quiz immediately on load
      });


      // Sound Toggle Button
      const soundToggleButton = document.getElementById("sound-toggle-button");
      const soundOnIcon = document.getElementById("sound-on-icon");
      const soundOffIcon = document.getElementById("sound-off-icon");
      const batSound = document.getElementById("bat-sound");
      const chimeSound = document.getElementById("chime-sound");
      const typingSound = document.getElementById("typing-sound");
      const evilLaughSound = document.getElementById("evil-laugh-sound");
      const wolfHowlSound = document.getElementById("wolf-howl-sound");

      let isSoundOn = true; // Initial state: sound ON

      soundToggleButton.addEventListener("click", () => {
        if (isSoundOn) {
          // Turn sound OFF
          if (batSound) batSound.pause();
          if (chimeSound) chimeSound.pause();
          if (typingSound) typingSound.pause();
          if (evilLaughSound) evilLaughSound.pause();
          if (wolfHowlSound) wolfHowlSound.pause();

          if (soundOnIcon) soundOnIcon.style.display = "none";
          if (soundOffIcon) soundOffIcon.style.display = "block";
        } else {
          // Turn sound ON
          if (batSound) batSound.play().catch((e) => console.error("Audio play failed:", e));

          if (soundOnIcon) soundOnIcon.style.display = "block";
          if (soundOffIcon) soundOffIcon.style.display = "none";
        }
        isSoundOn = !isSoundOn; // Toggle the state
      });

      // Bat animation
      const batContainer = document.getElementById("bat-container");
      const numBats = 5; // Number of bats

      function createBat() {
        const bat = document.createElement("img");
        bat.src = "halloween-flying-bat-sticker-u889c-x450.png"; // Make sure you have this image
        bat.className = "bat";
        batContainer.appendChild(bat);

        const startY = Math.random() * window.innerHeight;
        const endY = Math.random() * window.innerHeight;
        const midY = Math.random() * window.innerHeight; // For more varied paths

        bat.style.setProperty("--startY", `${startY}px`);
        bat.style.setProperty("--endY", `${endY}px`);
        bat.style.setProperty("--midY", `${midY}px`);

        const duration = 10 + Math.random() * 10; // 10-20 seconds
        bat.style.animationDuration = `${duration}s`;
        bat.style.animationIterationCount = "infinite";
        bat.style.left = `${-60}px`; // Start off-screen
        bat.style.top = `${startY}px`;

        // Randomly choose direction
        if (Math.random() > 0.5) {
          bat.style.animationName = "flyToRight";
        } else {
          bat.style.animationName = "flyToLeft";
        }

        // Restart animation when it ends
        bat.addEventListener("animationiteration", () => {
          bat.style.left = Math.random() > 0.5 ? `${-60}px` : `${window.innerWidth}px`;
          bat.style.top = `${Math.random() * window.innerHeight}px`;
          bat.style.animationName = Math.random() > 0.5 ? "flyToRight" : "flyToLeft";
          bat.style.setProperty("--startY", `${Math.random() * window.innerHeight}px`);
          bat.style.setProperty("--endY", `${Math.random() * window.innerHeight}px`);
          bat.style.setProperty("--midY", `${Math.random() * window.innerHeight}px`);
        });
      }

      for (let i = 0; i < numBats; i++) {
        createBat();
      }

      // Blood Drip Animation on Mouse Click
      document.addEventListener("click", (e) => {
        const drop = document.createElement("div");
        drop.className = "blood-drop";
        drop.style.left = `${e.clientX}px`;
        drop.style.top = `${e.clientY}px`;
        document.body.appendChild(drop);

        if (isSoundOn) {
          const dripSound = document.getElementById("drip-sound");
          if (dripSound) {
            dripSound.currentTime = 0; // Rewind to start
            dripSound.play().catch((e) => console.error("Drip sound play failed:", e));
          }
        }

        drop.addEventListener("animationend", () => {
          drop.remove();
        });
      });

      // Mist Effect on Scroll
      const mistOverlay = document.getElementById("mist-overlay");

      window.addEventListener("scroll", () => {
        const scrollPercentage = window.scrollY / (document.body.scrollHeight - window.innerHeight);
        mistOverlay.style.height = `${scrollPercentage * 100}vh`; // Adjust as needed
        mistOverlay.style.opacity = scrollPercentage * 0.7; // Adjust opacity
      });

      // Mouse Glow Effect
      const mouseGlow = document.getElementById("mouse-glow");

      document.addEventListener("mousemove", (e) => {
        mouseGlow.style.left = `${e.clientX}px`;
        mouseGlow.style.top = `${e.clientY}px`;
        mouseGlow.style.opacity = 1;
      });

      document.addEventListener("mouseleave", () => {
        mouseGlow.style.opacity = 0;
      });


      // Donor Registration and Letter Generation
      const donors = JSON.parse(localStorage.getItem("transylvaniaDonors")) || [];
      const bloodInventory = JSON.parse(localStorage.getItem("bloodInventory")) || {};

      function updateDonorList() {
        const donorList = document.getElementById("donor-list");
        const noDonorsMessage = document.getElementById("no-donors-message");
        donorList.innerHTML = ""; // Clear existing list

        if (donors.length === 0) {
          noDonorsMessage.style.display = "block";
        } else {
          noDonorsMessage.style.display = "none";
          donors.forEach((donor, index) => {
            const listItem = document.createElement("li");
            listItem.style.cssText = `
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      padding: 8px 0;
                      border-bottom: 1px dashed #550000;
                  `;
            listItem.innerHTML = `
                      <span style="color: #f5f5f5;"><i class="fas fa-user-circle" style="color: #e60000; margin-right: 8px;"></i>${donor.name} (${donor.group})</span>
                      <button onclick="removeDonor(${index})" style="background-color: #770000; width: auto; padding: 5px 10px; margin-top: 0; font-size: 0.8em;">Remove</button>
                  `;
            donorList.appendChild(listItem);
          });
        }
      }

      function updateBloodInventory() {
        const inventorySummary = document.getElementById("inventory-summary");
        let summaryText = "";
        let hasData = false;

        for (const group in bloodInventory) {
          if (bloodInventory[group] > 0) {
            summaryText += `${group}: ${bloodInventory[group]} units<br>`;
            hasData = true;
          }
        }

        if (!hasData) {
          inventorySummary.textContent = "No blood data available.";
        } else {
          inventorySummary.innerHTML = summaryText;
        }
      }

      function removeDonor(index) {
        const removedDonorGroup = donors[index].group;
        donors.splice(index, 1);
        localStorage.setItem("transylvaniaDonors", JSON.stringify(donors));

        // Decrease blood count in inventory
        if (bloodInventory[removedDonorGroup]) {
          bloodInventory[removedDonorGroup]--;
          if (bloodInventory[removedDonorGroup] < 0) {
            bloodInventory[removedDonorGroup] = 0; // Prevent negative
          }
          localStorage.setItem("bloodInventory", JSON.stringify(bloodInventory));
        }

        updateDonorList();
        updateBloodInventory();
      }

      function clearAllDonors() {
        if (confirm("Are you sure you want to clear all registered donors and blood inventory? This action cannot be undone.")) {
          localStorage.removeItem("transylvaniaDonors");
          localStorage.removeItem("bloodInventory");
          donors.length = 0; // Clear the array reference
          for (const group in bloodInventory) {
            delete bloodInventory[group]; // Clear inventory object
          }
          updateDonorList();
          updateBloodInventory();
        }
      }

      // Function to simulate typing effect
      function typeWriterEffect(element, text, speed) {
        let i = 0;
        element.textContent = ""; // Clear existing content
        element.classList.add("typing-cursor"); // Add typing cursor

        function type() {
          if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            if (isSoundOn) {
              // Play typing sound only if it's not already playing or has finished
              if (typingSound.paused || typingSound.ended) {
                typingSound.currentTime = 0; // Rewind to start
                typingSound.play().catch((e) => console.error("Typing sound play failed:", e));
              }
            }
            setTimeout(type, speed);
          }
        }
        type();
      }


      function submitDonor() {
        const nameInput = document.getElementById("name");
        const groupSelect = document.getElementById("group");
        const name = nameInput.value.trim();
        const group = groupSelect.value;
        const outputDiv = document.getElementById("output");
        const letterSection = document.getElementById("letter"); // Get the letter section

        if (name && group) {
          const newDonor = { name: name, group: group };
          donors.push(newDonor);
          localStorage.setItem("transylvaniaDonors", JSON.stringify(donors));

          // Update blood inventory
          bloodInventory[group] = (bloodInventory[group] || 0) + 1;
          localStorage.setItem("bloodInventory", JSON.stringify(bloodInventory));

          updateDonorList();
          updateBloodInventory();

          const letterContent = `Dearest ${name},

The crimson moon beckons, and your generosity resonates through the ancient halls of Transylvania. Your offering of ${group} blood is a vital essence to our network, ensuring the continued vitality of those who dwell in the shadows and light.

Your courage is noted, and your spirit, truly... *bloodylicious*.

We await your next benevolent visit under the shroud of night.

With eternal gratitude and a thirst for more,

Count Vladislaus and The Transylvania Blood Network`;

          typeWriterEffect(outputDiv, letterContent, 50);

          // Show confirmation box
          const confirmationBox = document.getElementById("donation-confirmation-box");
          confirmationBox.classList.add("show");
          setTimeout(() => {
            confirmationBox.classList.remove("show");
          }, 5000); // Hide after 5 seconds

          // Play chime sound
          if (isSoundOn) {
            if (chimeSound) {
              chimeSound.currentTime = 0;
              chimeSound.play().catch((e) => console.error("Chime sound play failed:", e));
            }
          }

          // Scroll to the letter section
          letterSection.scrollIntoView({ behavior: "smooth" });

          // Clear input fields after submission
          nameInput.value = "";
          groupSelect.value = "A+"; // Reset to default
        } else {
          outputDiv.textContent = "Please enter your name and select your blood group to generate your letter.";
        }
      }

      // Initial load for donor list and inventory
      updateDonorList();
      updateBloodInventory();


      // Transylvanian Secrets & Cravings (Facts & Compatibility)
      const vampireFacts = [
        "Vampires are often depicted as having a strong aversion to garlic.",
        "The word 'vampire' first appeared in English in 1734.",
        "Some folklore suggests vampires can only enter a home if invited.",
        "Bram Stoker's Dracula was published in 1897.",
        "In many cultures, a stake through the heart is a traditional way to kill a vampire.",
        "Vampires are typically nocturnal creatures, avoiding sunlight.",
        "The bat is a common animal associated with vampires, due to their nocturnal nature and blood-feeding habits (in some species).",
        "Before the word 'vampire' became popular, creatures like the 'strigoi' (Romania) or 'upyr' (Slavic) were known.",
        "Reflections in mirrors are said to not appear for vampires.",
        "Vlad the Impaler, a historical figure, is often associated with the inspiration for Dracula.",
      ];

      function displayRandomVampireFact() {
        const factOutput = document.getElementById("vampire-fact-output");
        const randomIndex = Math.floor(Math.random() * vampireFacts.length);
        const fact = vampireFacts[randomIndex];
        factOutput.textContent = fact;
        if (isSoundOn) {
          if (chimeSound) {
            chimeSound.currentTime = 0; // Rewind to start
            chimeSound.play().catch((e) => console.error("Chime sound play failed:", e));
          }
        }
      }

      const bloodCravingCompatibility = {
        "A+": "Craves sophisticated, well-balanced meals. Pairs well with a fine chianti.",
        "A-": "Prefers rare, earthy flavors. A robust, gamey taste will satisfy.",
        "B+": "Enjoys exotic and spicy concoctions. A hint of adventure is key.",
        "B-": "Desires something unique and often misunderstood. A bit of bitterness can be intriguing.",
        "AB+": "An adaptable palate, can enjoy almost anything. Perhaps a touch of metallic tang for variety.",
        "AB-": "A mysterious craving for the unconventional. Hints of the supernatural often accompany this desire.",
        "O+": "A universal hunger for rich, hearty sustenance. Comforting and familiar is often best.",
        "O-": "The most ancient craving, pure and unadulterated. The essence of life itself.",
      };

      function getBloodCraving() {
        const cravingGroup = document.getElementById("craving-group").value;
        const cravingOutput = document.getElementById("craving-output");
        cravingOutput.textContent = bloodCravingCompatibility[cravingGroup] || "No specific craving known for this type.";
        if (isSoundOn) {
          if (chimeSound) {
            chimeSound.currentTime = 0; // Rewind to start
            chimeSound.play().catch((e) => console.error("Chime sound play failed:", e));
          }
        }
      }

      // Bat Catcher Game
      const gameArea = document.getElementById("game-area");
      const scoreDisplay = document.getElementById("score-display");
      const timerDisplay = document.getElementById("timer-display");
      const gameStartButton = document.getElementById("game-start-button");
      let score = 0;
      let timeLeft = 30;
      let gameInterval;
      let batTimeout;
      let isGameRunning = false;

      function createVlad() {
        if (!isGameRunning) return;
        const vlad = document.createElement("img");
        vlad.src = "Vlad_Tepes_002.jpg"; // Your Vlad image
        vlad.className = "game-bat";
        gameArea.appendChild(vlad);

        const maxX = gameArea.clientWidth - vlad.offsetWidth;
        const maxY = gameArea.clientHeight - vlad.offsetHeight;
        const randomX = Math.floor(Math.random() * maxX);
        const randomY = Math.floor(Math.random() * maxY);

        vlad.style.left = `${randomX}px`;
        vlad.style.top = `${randomY}px`;

        vlad.addEventListener("click", () => {
          if (isGameRunning) {
            score++;
            scoreDisplay.textContent = `Score: ${score}`;
            vlad.remove(); // Remove clicked Vlad
            clearTimeout(batTimeout); // Clear timeout for current Vlad
            spawnNewVlad(); // Immediately spawn a new one
          }
        });

        // Remove Vlad if not clicked within a time (makes game harder)
        batTimeout = setTimeout(() => {
          if (vlad.parentNode === gameArea) {
            vlad.remove();
            spawnNewVlad(); // Spawn a new one even if not clicked
          }
        }, 1500 - (score * 10)); // Speed up as score increases
      }

      function spawnNewVlad() {
        // Clear any existing bats if they somehow remain
        document.querySelectorAll('.game-bat').forEach(bat => bat.remove());
        createVlad();
      }

      function startGame() {
        score = 0;
        timeLeft = 30;
        scoreDisplay.textContent = `Score: ${score}`;
        timerDisplay.textContent = `Time: ${timeLeft}s`;
        isGameRunning = true;
        gameStartButton.textContent = "Game Running...";
        gameStartButton.disabled = true;
        gameStartButton.classList.add("disabled");

        // Clear previous game elements
        document.querySelectorAll('.game-bat').forEach(bat => bat.remove());
        clearTimeout(batTimeout);
        clearInterval(gameInterval);

        spawnNewVlad(); // Create the first Vlad

        gameInterval = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = `Time: ${timeLeft}s`;
          if (timeLeft <= 0) {
            endGame();
          }
        }, 1000);
      }

      function endGame() {
        clearInterval(gameInterval);
        clearTimeout(batTimeout); // Clear any pending bat timeouts
        isGameRunning = false;
        gameStartButton.textContent = "Start Game";
        gameStartButton.disabled = false;
        gameStartButton.classList.remove("disabled");
        alert(`Game Over! Your final score is: ${score}`);
        // Remove all remaining bats
        document.querySelectorAll('.game-bat').forEach(bat => bat.remove());
      }

      if (gameStartButton) {
        gameStartButton.addEventListener("click", startGame);
      }

      // Countdown Timer
      let targetDate;
      let countdownInterval;

      // Get the countdown display elements
      const daysSpan = document.getElementById("days");
      const hoursSpan = document.getElementById("hours");
      const minutesSpan = document.getElementById("minutes");
      const secondsSpan = document.getElementById("seconds");
      const countdownMessage = document.getElementById("countdown-message");
      const startCountdownButton = document.getElementById("start-countdown-button");

      function countdown() {
        const now = new Date().getTime();
        const distance = targetDate - now;

        if (distance < 0) {
          clearInterval(countdownInterval);
          countdownMessage.textContent = "Transformation Complete! Mwahahaha!";
          countdownMessage.classList.add("countdown-finished");
          daysSpan.textContent = "00";
          hoursSpan.textContent = "00";
          minutesSpan.textContent = "00";
          secondsSpan.textContent = "00";

          if (isSoundOn && evilLaughSound) {
            evilLaughSound.currentTime = 0;
            evilLaughSound.play().catch((e) => console.error("Evil laugh sound play failed:", e));
          }
          return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        daysSpan.textContent = String(days).padStart(2, '0');
        hoursSpan.textContent = String(hours).padStart(2, '0');
        minutesSpan.textContent = String(minutes).padStart(2, '0');
        secondsSpan.textContent = String(seconds).padStart(2, '0');

        countdownMessage.textContent = "Register as a donor to begin your mystical transformation countdown...";
        countdownMessage.classList.remove("countdown-finished");
      }

      function startDemoCountdown() {
        // Clear any existing interval to prevent multiple timers running
        clearInterval(countdownInterval);

        // Set a target date, e.g., 3 days from now
        const now = new Date();
        targetDate = new Date(now.getTime() + (3 * 24 * 60 * 60 * 1000)); // 3 days from now

        // Update the countdown immediately and then every second
        countdown();
        countdownInterval = setInterval(countdown, 1000);
      }

      if (startCountdownButton) {
        startCountdownButton.addEventListener("click", startDemoCountdown);
      }

      // Vampire Quiz
      const quizQuestions = [
        {
          question: "What is the traditional weakness of vampires?",
          options: ["Garlic", "Sunlight", "Holy water", "All of the above"],
          answer: "All of the above",
        },
        {
          question: "Which country is Count Dracula traditionally associated with?",
          options: ["Germany", "Transylvania (Romania)", "France", "Italy"],
          answer: "Transylvania (Romania)",
        },
        {
          question: "What animal is often associated with vampires?",
          options: ["Wolf", "Bat", "Owl", "Spider"],
          answer: "Bat",
        },
        {
          question: "What is the name of Bram Stoker's famous vampire novel?",
          options: ["Frankenstein", "Dr. Jekyll and Mr. Hyde", "Dracula", "The Raven"],
          answer: "Dracula",
        },
        {
          question: "According to some folklore, how can a vampire enter a home?",
          options: ["By force", "If invited", "Through a window", "They can enter freely"],
          answer: "If invited",
        },
      ];

      let currentQuestionIndex = 0;
      let score = 0;

      // Get quiz elements
      const quizContainer = document.getElementById("quiz-container");
      const questionElement = document.getElementById("quiz-question");
      const optionsContainer = document.getElementById("quiz-options");
      const nextButton = document.getElementById("next-button");
      const submitButton = document.getElementById("submit-button");
      const resultDisplay = document.getElementById("quiz-result");
      const retakeQuizButton = document.getElementById("retake-quiz-button");
      const quizFeedback = document.getElementById("quiz-feedback");


      function loadQuiz() {
        // Ensure elements are available before trying to manipulate them
        if (!questionElement || !optionsContainer || !nextButton || !submitButton || !resultDisplay || !retakeQuizButton || !quizFeedback) {
          console.error("One or more quiz elements not found in the DOM.");
          return;
        }

        resetQuizState(); // Reset state when loading a new quiz

        if (currentQuestionIndex < quizQuestions.length) {
          const currentQuestion = quizQuestions[currentQuestionIndex];
          questionElement.textContent = currentQuestion.question;
          optionsContainer.innerHTML = "";
          currentQuestion.options.forEach((option) => {
            const label = document.createElement("label");
            label.innerHTML = `<input type="radio" name="answer" value="${option}"> ${option}`;
            optionsContainer.appendChild(label);
          });

          // Show/hide buttons based on current question
          nextButton.style.display = currentQuestionIndex === quizQuestions.length - 1 ? "none" : "block";
          submitButton.style.display = currentQuestionIndex === quizQuestions.length - 1 ? "block" : "none";
          resultDisplay.style.display = "none";
          retakeQuizButton.style.display = "none";
        } else {
          displayResult();
        }
      }

      function selectAnswer() {
        const selectedOption = document.querySelector('input[name="answer"]:checked');
        if (selectedOption) {
          const userAnswer = selectedOption.value;
          const correctAnswer = quizQuestions[currentQuestionIndex].answer;

          if (userAnswer === correctAnswer) {
            score++;
            quizFeedback.textContent = "Correct!";
            quizFeedback.style.color = "#00ff00";
          } else {
            quizFeedback.textContent = `Incorrect. The correct answer was: ${correctAnswer}`;
            quizFeedback.style.color = "#ff0000";
          }
          quizFeedback.style.display = "block"; // Show feedback

          // Disable options after selection
          optionsContainer.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);

          if (isSoundOn) {
            if (chimeSound) {
              chimeSound.currentTime = 0;
              chimeSound.play().catch((e) => console.error("Chime sound play failed:", e));
            }
          }
        } else {
          quizFeedback.textContent = "Please select an answer.";
          quizFeedback.style.color = "#ffff00";
          quizFeedback.style.display = "block";
        }
      }

      function handleNextQuestion() {
        selectAnswer(); // Process the current answer before moving
        setTimeout(() => { // Give a brief moment for feedback to be seen
          quizFeedback.style.display = "none"; // Hide feedback
          currentQuestionIndex++;
          if (currentQuestionIndex < quizQuestions.length) {
            loadQuiz();
          } else {
            displayResult();
          }
        }, 1000); // 1 second delay
      }

      function displayResult() {
        questionElement.textContent = "";
        optionsContainer.innerHTML = "";
        quizFeedback.style.display = "none";
        nextButton.style.display = "none";
        submitButton.style.display = "none";

        resultDisplay.innerHTML = `You scored ${score} out of ${quizQuestions.length} questions.`;
        resultDisplay.style.display = "block";
        retakeQuizButton.style.display = "block";

        if (isSoundOn && wolfHowlSound) { // Play wolf howl when quiz finishes
          wolfHowlSound.currentTime = 0;
          wolfHowlSound.play().catch((e) => console.error("Wolf howl sound play failed:", e));
        }
      }

      function resetQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        resultDisplay.style.display = "none";
        retakeQuizButton.style.display = "none";
        quizFeedback.style.display = "none";
        loadQuiz();
      }

      function resetQuizState() {
        // Re-enable radio buttons for the next question
        optionsContainer.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = false);
        // Clear any existing feedback
        quizFeedback.textContent = "";
        quizFeedback.style.display = "none";
      }

      function startQuiz() {
          loadQuiz(); // Load the first question
          // Ensure initial button visibility is correct
          if (nextButton) nextButton.style.display = "block";
          if (submitButton) submitButton.style.display = "none"; // Hide submit until last question
          if (resultDisplay) resultDisplay.style.display = "none";
          if (retakeQuizButton) retakeQuizButton.style.display = "none";
      }


      // Event Listeners for Quiz Buttons
      if (nextButton) {
        nextButton.addEventListener("click", handleNextQuestion);
      }
      if (submitButton) {
        submitButton.addEventListener("click", selectAnswer); // selectAnswer will call displayResult for last question
      }
      if (retakeQuizButton) {
        retakeQuizButton.addEventListener("click", resetQuiz);
      }
    </script>
  </body>
</html>