<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transylvania Blood Network - NOT FUNCTIONAL AON</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style>
      /* CSS pentru site-ul principal */
      body {
        margin: 0;
        padding: 0;
        font-family: "Cinzel Decorative", serif;
        background-color: #0d0d0d;
        color: #f5f5f5;
        overflow-x: hidden;
        position: relative;
        background-image: url("https://images.unsplash.com/photo-1542848906-8809e6c38b25?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: -1;
      }

      #initial-welcome-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95);
        z-index: 100000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: #f5f5f5;
        text-align: center;
        opacity: 1;
        transition: opacity 1s ease-in-out, visibility 1s ease-in-out;
        visibility: visible;
      }

      #initial-welcome-overlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      #initial-welcome-overlay .welcome-image {
        max-width: 80%;
        max-height: 50vh;
        border: 3px solid #e60000;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.7);
        border-radius: 8px;
        margin-bottom: 30px;
        object-fit: contain;
      }

      #initial-welcome-overlay h2 {
        color: #e60000;
        font-size: 2.5em;
        margin-bottom: 15px;
        text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
      }

      #initial-welcome-overlay p {
        font-size: 1.2em;
        color: #ccc;
        margin-bottom: 40px;
        font-family: "Dancing Script", cursive;
      }

      #initial-welcome-overlay button {
        background-color: #e60000;
        color: #f5f5f5;
        padding: 15px 30px;
        border: 2px solid #ff3333;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1.3em;
        font-weight: bold;
        letter-spacing: 1px;
        transition: background-color 0.3s ease, transform 0.2s ease,
          box-shadow 0.3s ease;
      }

      #initial-welcome-overlay button:hover {
        background-color: #cc0000;
        transform: scale(1.05);
        box-shadow: 0 0 25px rgba(255, 0, 0, 0.9);
      }

      header {
        background-color: #1a1a1a;
        padding: 20px;
        text-align: center;
        font-size: 32px;
        color: #e60000;
        position: sticky;
        top: 0;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header-logo {
        height: 80px;
        width: auto;
        margin-right: 15px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
      }

      nav {
        background-color: #1a1a1a;
        padding: 10px 0;
        text-align: center;
        position: sticky;
        top: 72px;
        z-index: 999;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .nav-row {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 5px;
      }

      .nav-row:last-child {
        margin-bottom: 0;
      }

      nav a {
        color: #ccc;
        margin: 0 15px;
        text-decoration: none;
        font-size: 1.1em;
        transition: color 0.3s ease, text-shadow 0.3s ease;
        display: flex;
        align-items: center;
        white-space: nowrap;
        padding: 5px 0;
      }

      nav a i {
        margin-right: 8px;
        font-size: 1.2em;
        color: #e60000;
        transition: color 0.3s ease;
      }

      nav a:hover {
        color: #e60000;
        text-shadow: 0 0 8px rgba(255, 0, 0, 0.7);
      }

      nav a:hover i {
        color: #ff3333;
      }

      section {
        padding: 40px;
        max-width: 700px;
        margin: auto;
        line-height: 1.6;
        background-color: rgba(26, 26, 26, 0.8);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.4);
        margin-top: 30px;
        position: relative;
        z-index: 10;
      }

      h2 {
        color: #e60000;
        text-align: center;
        margin-bottom: 25px;
        font-size: 2em;
      }

      input,
      select,
      button,
      textarea {
        padding: 12px;
        margin-top: 10px;
        width: calc(100% - 24px);
        background: #2a2a2a;
        color: #f5f5f5;
        border: 1px solid #e60000;
        border-radius: 5px;
        font-family: "Cinzel Decorative", serif;
        font-size: 1em;
        transition: background 0.3s ease, border-color 0.3s ease,
          box-shadow 0.3s ease;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #ff3333;
        box-shadow: 0 0 8px rgba(255, 51, 51, 0.6);
      }

      button {
        background-color: #e60000;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
        font-weight: bold;
        letter-spacing: 1px;
      }

      button:hover {
        background-color: #cc0000;
      }

      #letter {
        background-color: rgba(26, 26, 26, 0.8);
        padding: 20px;
        border: 1px dashed #e60000;
        margin-top: 20px;
        border-radius: 8px;
        box-shadow: inset 0 0 10px rgba(230, 0, 0, 0.3);
        white-space: pre-wrap;
      }

      #output {
        font-family: "Dancing Script", cursive;
        font-size: 1.5em;
        color: #ccc;
        min-height: 200px;
      }

      .typing-cursor::after {
        content: "|";
        display: inline-block;
        animation: blink-caret 0.75s infinite;
      }

      @keyframes blink-caret {
        from,
        to {
          border-color: transparent;
        }
        50% {
          border-color: #e60000;
        }
      }

      .bat {
        position: fixed;
        width: 60px;
        height: auto;
        pointer-events: none;
        opacity: 0.7;
        filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.3));
        z-index: 5;
      }

      @keyframes flyToRight {
        0% {
          transform: translateX(0vw) translateY(var(--startY)) scaleX(1);
          opacity: 0.7;
        }
        50% {
          transform: translateX(50vw) translateY(var(--midY)) scaleX(1);
        }
        100% {
          transform: translateX(100vw) translateY(var(--endY)) scaleX(1);
          opacity: 0.7;
        }
      }

      @keyframes flyToLeft {
        0% {
          transform: translateX(100vw) translateY(var(--startY)) scaleX(-1);
          opacity: 0.7;
        }
        50% {
          transform: translateX(50vw) translateY(var(--midY)) scaleX(-1);
        }
        100% {
          transform: translateX(0vw) translateY(var(--endY)) scaleX(-1);
          opacity: 0.7;
        }
      }

      .blood-drop {
        position: absolute;
        background-color: #e60000;
        border-radius: 50%;
        opacity: 0.8;
        pointer-events: none;
        animation: drip 1s ease-out forwards;
        filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.7));
      }

      @keyframes drip {
        0% {
          transform: translateY(0) scale(0.5);
          opacity: 0.8;
        }
        100% {
          transform: translateY(50px) scale(1);
          opacity: 0;
        }
      }

      .mist-overlay {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 0;
        background: linear-gradient(to top, rgba(230, 0, 0, 0.2), transparent);
        z-index: 20;
        pointer-events: none;
        transition: height 0.5s ease-out;
      }

      #mouse-glow {
        position: fixed;
        width: 50px;
        height: 50px;
        background-color: rgba(255, 0, 0, 0.1);
        border-radius: 50%;
        pointer-events: none;
        transform: translate(-50%, -50%);
        filter: blur(20px);
        z-index: 50;
        opacity: 0;
        transition: opacity 0.5s ease-out;
      }

      #sound-toggle-button {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background-color: #f5f5f5;
        border: none;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        z-index: 200;
        transition: background-color 0.3s ease, transform 0.2s ease,
          box-shadow 0.3s ease;
      }

      #sound-toggle-button:hover {
        background-color: #e0e0e0;
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
      }

      #sound-toggle-button img {
        width: 35px;
        height: 35px;
        display: block;
        object-fit: contain;
      }

      #sound-on-icon {
        display: none;
      }

      #bat-catcher-game {
        background-color: rgba(26, 26, 26, 0.8);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.4);
        margin-top: 30px;
        padding: 20px;
        text-align: center;
      }

      #game-area {
        width: 100%;
        height: 300px;
        border: 2px dashed #e60000;
        margin: 20px auto;
        position: relative;
        overflow: hidden;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 5px;
        cursor: crosshair;
      }

      .game-bat {
        position: absolute;
        width: 80px;
        height: auto;
        cursor: pointer;
        transition: transform 0.1s ease-out;
        filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.5));
      }

      .game-bat:hover {
        transform: scale(1.1);
      }

      #game-info {
        display: flex;
        justify-content: space-around;
        margin-bottom: 15px;
        font-size: 1.2em;
        color: #f5f5f5;
      }

      #game-start-button {
        background-color: #008000;
        transition: background-color 0.3s ease;
      }

      #game-start-button:hover {
        background-color: #006400;
      }

      #game-start-button.disabled {
        background-color: #555;
        cursor: not-allowed;
      }

      #transition-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("dracula.jpeg");
        background-size: cover;
        background-position: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 1.5s ease-in-out;
      }

      #contact-us form label {
        display: block;
        margin-top: 15px;
        margin-bottom: 5px;
        color: #e60000;
        font-weight: bold;
      }

      #contact-us textarea {
        min-height: 120px;
        resize: vertical;
      }

      #contact-us .success-message {
        margin-top: 20px;
        padding: 15px;
        background-color: rgba(0, 128, 0, 0.3);
        border: 1px solid #008000;
        border-radius: 5px;
        color: #f5f5f5;
        text-align: center;
        font-weight: bold;
        display: none;
      }

      #vampire-quiz {
        background-color: rgba(26, 26, 26, 0.8);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.4);
        margin-top: 30px;
        padding: 20px;
      }

      .quiz-question {
        background-color: rgba(42, 42, 42, 0.7);
        border: 1px solid #550000;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
        text-align: left;
      }

      .quiz-question p {
        font-size: 1.1em;
        color: #f5f5f5;
        margin-bottom: 15px;
      }

      .quiz-options {
        display: grid;
        gap: 10px;
      }

      .quiz-options label {
        display: block;
        background: #2a2a2a;
        color: #ccc;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #e60000;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .quiz-options label:hover {
        background-color: #3a0000;
        color: #fff;
      }

      .quiz-options input[type="radio"] {
        margin-right: 10px;
        accent-color: #e60000;
      }

      #submit-quiz {
        background-color: #e60000;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
        font-weight: bold;
        letter-spacing: 1px;
        padding: 12px;
        border: none;
        border-radius: 5px;
        color: #f5f5f5;
        font-family: "Cinzel Decorative", serif;
        font-size: 1em;
        transition: background-color 0.3s ease;
      }

      #submit-quiz:hover {
        background-color: #cc0000;
      }

      #quiz-result {
        margin-top: 20px;
        text-align: center;
        font-size: 1.3em;
        color: #e60000;
        font-family: "Dancing Script", cursive;
      }

      #result-description {
        margin-top: 10px;
        text-align: center;
        color: #ccc;
        font-style: italic;
      }

      .quiz-progress {
        color: #ccc;
        text-align: center;
        margin-bottom: 15px;
        font-style: italic;
      }

      .quiz-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
      }

      .quiz-navigation button {
        background-color: #550000;
        color: #f5f5f5;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-family: "Cinzel Decorative", serif;
      }

      .quiz-navigation button:hover {
        background-color: #770000;
      }

      #countdown-timer {
        background: linear-gradient(
          135deg,
          rgba(26, 26, 26, 0.95),
          rgba(42, 42, 42, 0.85)
        );
        border: 2px solid #e60000;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 0 30px rgba(230, 0, 0, 0.6),
          inset 0 0 20px rgba(0, 0, 0, 0.8);
        position: relative;
        overflow: hidden;
      }

      #countdown-timer::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #e60000, #ff3333, #cc0000, #e60000);
        border-radius: 15px;
        z-index: -1;
        animation: borderPulse 3s ease-in-out infinite;
      }

      @keyframes borderPulse {
        0%,
        100% {
          opacity: 0.7;
        }
        50% {
          opacity: 1;
        }
      }

      .countdown-title {
        font-size: 1.8em;
        color: #e60000;
        margin-bottom: 20px;
        text-shadow: 0 0 10px rgba(230, 0, 0, 0.8);
        letter-spacing: 2px;
      }

      .timer-display {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .time-unit {
        background: rgba(0, 0, 0, 0.8);
        border: 1px solid #e60000;
        border-radius: 10px;
        padding: 15px 10px;
        min-width: 80px;
        position: relative;
        overflow: hidden;
      }

      .time-unit::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(230, 0, 0, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .time-number {
        font-size: 2.5em;
        color: #f5f5f5;
        font-weight: bold;
        text-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
        display: block;
        line-height: 1;
        animation: numberGlow 2s ease-in-out infinite alternate;
      }

      @keyframes numberGlow {
        from {
          text-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
        }
        to {
          text-shadow: 0 0 25px rgba(255, 0, 0, 1),
            0 0 35px rgba(255, 0, 0, 0.5);
        }
      }

      .time-label {
        font-size: 0.9em;
        color: #ccc;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 5px;
      }

      .countdown-message {
        margin-bottom: 20px;
        font-size: 1.2em;
        color: #ccc;
        font-style: italic;
        min-height: 25px;
      }

      .countdown-finished {
        animation: finishedPulse 1s ease-in-out infinite;
        color: #ff3333 !important;
        font-weight: bold;
      }

      @keyframes finishedPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .demo-button {
        background: linear-gradient(135deg, #e60000, #cc0000);
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        color: #f5f5f5;
        font-family: "Cinzel Decorative", serif;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 20px;
        width: 100%;
      }

      .demo-button:hover {
        background: linear-gradient(135deg, #ff3333, #e60000);
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.8);
        transform: translateY(-2px);
      }

      #donation-confirmation-box {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: rgba(26, 26, 26, 0.9);
        border: 2px solid #e60000;
        border-radius: 10px;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 500;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.7);
        opacity: 0;
        visibility: hidden;
        transform: translateY(100%);
        transition: opacity 0.5s ease-out, transform 0.5s ease-out,
          visibility 0.5s ease-out;
      }

      #donation-confirmation-box.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      #donation-confirmation-box img {
        width: 50px;
        height: auto;
      }

      #donation-confirmation-box p {
        margin: 0;
        color: #f5f5f5;
        font-size: 1.1em;
        font-family: "Dancing Script", cursive;
        text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
      }

      /* CSS pentru harta */
      #transylvania-map {
        display: none;
        padding: 40px;
        max-width: 800px;
        margin: auto;
        line-height: 1.6;
        background-color: rgba(26, 26, 26, 0.8);
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(230, 0, 0, 0.4);
        margin-top: 30px;
        position: relative;
        z-index: 10;
      }

      #map {
        height: 500px;
        width: 100%;
        border-radius: 10px;
        margin-top: 20px;
      }

      /* CSS pentru jocul 3D */
      .lab-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1000;
        background-color: #1a1a1a;
      }

      .lab-header {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 850px;
        background-color: rgba(43, 0, 0, 0.85);
        border: 2px solid #5a0000;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.7);
        text-align: center;
        z-index: 10;
        backdrop-filter: blur(5px);
      }

      .lab-canvas-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        cursor: grab;
      }

      .close-lab {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #8b0000;
        color: #f5f5dc;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        font-size: 16px;
        cursor: pointer;
        z-index: 100;
      }

      #info-panel {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 850px;
        background-color: rgba(43, 0, 0, 0.85);
        border: 2px solid #5a0000;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.7);
        text-align: center;
        z-index: 10;
        backdrop-filter: blur(5px);
      }

      #instructions {
        color: #e0e0e0;
        font-size: 1.3em;
        min-height: 40px;
      }

      #canvas-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        cursor: grab;
      }

      canvas {
        display: block;
      }

      #lab-container button {
        background-color: #8b0000;
        color: #f5f5dc;
        padding: 12px 25px;
        border: 2px solid #a00000;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 5px;
        font-family: "MedievalSharp", cursive, sans-serif;
        box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
      }

      #lab-container button:hover:not(:disabled) {
        background-color: #a00000;
        transform: translateY(-2px);
        box-shadow: 5px 5px 12px rgba(0, 0, 0, 0.6);
      }

      #lab-container button:disabled {
        background-color: #555;
        color: #999;
        cursor: not-allowed;
      }

      #lab-container select {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #5a0000;
        margin: 0 10px;
        font-size: 1em;
        background-color: #3a1a1a;
        color: #f5f5dc;
        font-family: "MedievalSharp", cursive, sans-serif;
      }

      .hidden {
        display: none !important;
      }

      #final-feedback-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
        z-index: 100;
        text-align: center;
      }
      #final-feedback-text {
        font-size: 3.5em;
        font-weight: bold;
        text-shadow: 3px 3px 8px black;
        padding: 20px;
      }
      #final-feedback-overlay.success {
        background: rgba(49, 115, 52, 0.85);
      }
      #final-feedback-overlay.error {
        background: rgba(169, 50, 38, 0.85);
      }

      @media (max-width: 768px) {
        #initial-welcome-overlay .welcome-image {
          max-width: 90%;
          max-height: 40vh;
          margin-bottom: 20px;
        }
        #initial-welcome-overlay h2 {
          font-size: 1.8em;
        }
        #initial-welcome-overlay p {
          font-size: 1em;
          padding: 0 15px;
        }
        #initial-welcome-overlay button {
          font-size: 1em;
          padding: 12px 25px;
        }

        header {
          font-size: 24px;
          flex-direction: column;
        }

        .header-logo {
          height: 60px;
          margin-bottom: 10px;
          margin-right: 0;
        }

        nav {
          top: 60px;
          padding: 8px 0;
        }

        nav a {
          margin: 0 8px;
          font-size: 0.9em;
          padding: 3px 0;
        }

        nav a i {
          margin-right: 5px;
          font-size: 1em;
        }

        section {
          padding: 20px;
          margin: 20px auto;
        }

        #sound-toggle-button {
          width: 50px;
          height: 50px;
          bottom: 10px;
          left: 10px;
        }

        #sound-toggle-button img {
          width: 28px;
          height: 28px;
        }

        #game-area {
          height: 200px;
        }

        #vampire-quiz {
          padding: 20px;
        }

        .timer-display {
          gap: 10px;
        }

        .time-unit {
          min-width: 70px;
          padding: 10px 5px;
        }

        .time-number {
          font-size: 2em;
        }

        .countdown-title {
          font-size: 1.5em;
        }

        #donation-confirmation-box {
          bottom: 10px;
          right: 10px;
          padding: 10px;
          flex-direction: column;
          text-align: center;
        }

        #donation-confirmation-box img {
          width: 40px;
        }

        #donation-confirmation-box p {
          font-size: 0.9em;
        }
      }
    </style>
  </head>
  <body>
    <div id="initial-welcome-overlay">
      <img src="dracula.jpeg" alt="Dracula Welcome" class="welcome-image" />
      <h2>Welcome to the Transylvania Blood Network.</h2>
      <p>Prepare to delve into the shadows...</p>
      <button id="enter-site-button">Enter at Your Own Risk</button>
    </div>
    <div id="bat-container"></div>
    <div id="mouse-glow"></div>
    <div class="mist-overlay" id="mist-overlay"></div>
    <div id="transition-overlay"></div>
    <audio id="bat-sound" loop>
      <source src="Toccata-and-fugue-in-d-minor.mp3" type="audio/mp3" />
      Your browser does not support the audio element.
    </audio>
    <audio id="drip-sound">
      <source src="water-drip-72357.mp3" type="audio/mp3" />
    </audio>
    <audio id="chime-sound">
      <source src="spooky-chimes-359877.mp3" type="audio/mp3" />
    </audio>
    <audio id="typing-sound">
      <source src="typewriter-100-88009.mp3" type="audio/mp3" />
      Your browser does not support the audio element.
    </audio>
    <audio id="wolf-howl-sound">
      <source src="wolf-howl.mp3" type="audio/mp3" />
      Your browser does not support the audio element.
    </audio>
    <audio id="evil-laugh-sound">
      <source src="evil-laugh-89423.mp3" type="audio/mp3" />
      Your browser does not support the audio element.
    </audio>
    <header>
      <img
        src="blood-donors-needed-halloween-dracula-volunteer-light-nikita-goel.jpg"
        alt="Transylvania Blood Network Logo"
        class="header-logo"
      />
      🩸 Transylvania Blood Network
    </header>
    <nav>
      <div class="nav-row">
        <a href="#home"><i class="fas fa-home"></i> Home</a>
        <a href="#donate"><i class="fas fa-hand-holding-heart"></i> Donate</a>
        <a href="#registered-donors"><i class="fas fa-users"></i> Donors</a>
        <a href="#facts-cravings"><i class="fas fa-scroll"></i> Secrets</a>
        <a href="#bat-catcher-game" ><i class="fas fa-crosshairs"></i> Catch Vlad!</a >
      </div>
      <div class="nav-row">
        <a href="#transylvania-map" ><i class="fas fa-map-marked-alt"></i> Blood Centers</a >
        <a href="game.html">Blood Lab</a>
        <a href="#vampire-quiz" ><i class="fas fa-question-circle"></i> Vampire Quiz</a >
        <a href="#countdown-section" ><i class="fas fa-moon"></i> Transformation</a >
        <a href="#letter" ><i class="fas fa-envelope-open-text"></i> Your Letter</a >
      </div>
      <div class="nav-row">
        <a href="#contact-us"><i class="fas fa-paper-plane"></i> Contact</a>
        <a href="#about"><i class="fas fa-info-circle"></i> About</a>
      </div>
    </nav>
    <section id="home">
      <h2>Welcome</h2>
      <p>
        Transylvania Blood Network connects generous donors with those who need
        them most. But more than blood, we deliver humanity, wrapped in a veil
        of ancient mystery. Every pulse, a story. Every drop, a destiny.
      </p>
    </section>
    <section id="donate">
      <h2>Become a Donor</h2>
      <label for="name">Your Name</label>
      <input type="text" id="name" placeholder="Enter your name..." />
      <label for="group">Blood Group</label>
      <select id="group">
        <option>A+</option>
        <option>A-</option>
        <option>B+</option>
        <option>B-</option>
        <option>AB+</option>
        <option>AB-</option>
        <option>O+</option>
        <option>O-</option>
      </select>
      <button onclick="submitDonor()">Generate Letter</button>
    </section>
    <section id="registered-donors">
      <h2>Registered Donors & Blood Inventory</h2>
      <div
        id="donor-list-container"
        style="
          max-height: 300px;
          overflow-y: auto;
          border: 1px solid #e60000;
          padding: 10px;
          border-radius: 5px;
          margin-bottom: 20px;
        "
      >
        <p id="no-donors-message" style="text-align: center; color: #ccc">
          No donors registered yet.
        </p>
        <ul id="donor-list" style="list-style-type: none; padding: 0"></ul>
      </div>
      <div
        id="blood-inventory"
        style="
          background-color: rgba(42, 42, 42, 0.8);
          padding: 15px;
          border-radius: 5px;
          border: 1px solid #e60000;
        "
      >
        <h3>Current Blood Inventory:</h3>
        <p id="inventory-summary" style="color: #f5f5f5">
          No blood data available.
        </p>
      </div>
      <button onclick="clearAllDonors()" style="margin-top: 20px; background-color: #550000" >
        Clear All Donors (Local)
      </button>
    </section>
    <section id="facts-cravings">
      <h2>Transylvanian Secrets & Cravings</h2>
      <h3>Random Vampire Fact:</h3>
      <button onclick="displayRandomVampireFact()">Reveal a Secret</button>
      <p
        id="vampire-fact-output"
        style="margin-top: 15px; font-style: italic; color: #ccc"
      >
        Click to uncover ancient truths.
      </p>
      <h3 style="margin-top: 30px">Blood Type Craving Compatibility:</h3>
      <label for="craving-group">Select Blood Type:</label>
      <select id="craving-group">
        <option>A+</option>
        <option>A-</option>
        <option>B+</option>
        <option>B-</option>
        <option>AB+</option>
        <option>AB-</option>
        <option>O+</option>
        <option>O-</option>
      </select>
      <button onclick="getBloodCraving()">Discover Cravings</button>
      <p
        id="craving-output"
        style="margin-top: 15px; font-style: italic; color: #ccc"
      >
        What will your blood crave tonight?
      </p>
    </section>
    <section id="bat-catcher-game">
      <h2>Catch Vlad!</h2>
      <p>
        Click on Vlad Tepes as fast as you can to score points before time runs
        out!
      </p>
      <div id="game-info">
        <span id="score-display">Score: 0</span>
        <span id="timer-display">Time: 30s</span>
      </div>
      <div id="game-area"></div>
      <button id="game-start-button">Start Game!</button>
    </section>

    <section id="transylvania-map">
      <h2>Centre de donare din Transilvania</h2>
      <div id="map"></div>
    </section>

    <section id="vampire-quiz">
      <h2>How Much Vampire Are You?</h2>
      <p class="quiz-progress" id="quiz-progress">Question 1 of 10</p>
      <div id="quiz-container"></div>
      <div class="quiz-navigation" id="quiz-navigation">
        <button id="prev-question" style="display: none">← Previous</button>
        <button id="next-question">Next →</button>
      </div>
      <button id="submit-quiz" style="display: none">
        Reveal Your True Nature
      </button>
      <div id="quiz-result"></div>
      <div id="result-description"></div>
    </section>
    <section id="countdown-section">
      <h2>Transformation Countdown</h2>
      <div id="countdown-timer">
        <div class="countdown-title">⏰ Time Until Next Blood Moon</div>
        <div class="timer-display">
          <div class="time-unit">
            <span class="time-number" id="days">00</span>
            <div class="time-label">Days</div>
          </div>
          <div class="time-unit">
            <span class="time-number" id="hours">00</span>
            <div class="time-label">Hours</div>
          </div>
          <div class="time-unit">
            <span class="time-number" id="minutes">00</span>
            <div class="time-label">Minutes</div>
          </div>
          <div class="time-unit">
            <span class="time-number" id="seconds">00</span>
            <div class="time-label">Seconds</div>
          </div>
        </div>
        <div class="countdown-message" id="countdown-message">
          Register as a donor to begin your mystical transformation countdown...
        </div>
        <button class="demo-button" onclick="startDemoCountdown()">
          🩸 Become a Donor (Demo)
        </button>
      </div>
    </section>
    <section id="letter">
      <h2>Your Letter</h2>
      <div id="output">Fill in your data above to see your letter.</div>
    </section>
    <section id="contact-us">
      <h2>Send a Message</h2>
      <p>
        Do you have a question, a secret to share, or an eerie suggestion? Send
        us a raven message!
      </p>
      <form id="contact-form">
        <label for="contact-name">Your Name</label>
        <input type="text" id="contact-name" placeholder="Enter your name..." required />
        <label for="contact-email">Your Email</label>
        <input type="email" id="contact-email" placeholder="Enter your email..." required />
        <label for="contact-message">Your Message</label>
        <textarea
          id="contact-message"
          placeholder="Type your message here..."
          required
        ></textarea>
        <button type="submit">Send Message</button>
        <div id="contact-success-message" class="success-message"></div>
      </form>
    </section>
    <section id="about">
      <h2>About</h2>
      <p>
        This web app was created in a 48h hackathon by a team of beginner
        developers from Romania. Inspired by our culture and humanity, we
        believe every drop tells a story. And perhaps, awakens something more
        primal within us all.
      </p>
    </section>
    <button id="sound-toggle-button" aria-label="Toggle Sound">
      <img
        id="sound-off-icon"
        src="haut-parleur-rouge-et-icone-sonore.png"
        alt="Sound Off"
      />
      <img
        id="sound-on-icon"
        src="icone-du-son-et-du-haut-parleur-rouge.png"
        alt="Sound On"
      />
    </button>
    <div id="donation-confirmation-box">
      <img src="vampire-lips-sticker-u56fd-x450.png" alt="Vampire Lips Sticker" />
      <p>YOU ARE VERY BLOODYLICIOUS</p>
    </div>
    <div id="lab-container" class="lab-container">
      <button class="close-lab" id="close-lab">×</button>
      <div class="lab-header">
        <h1>3D Transfusion Lab</h1>
        <p id="instructions">
          Drag the syringe to the patient's arm to collect blood.
        </p>
        <div id="confirmation-wrapper" class="hidden">
          <select id="blood-type-select"></select>
          <button id="confirm-type-button">Confirm Blood Type</button>
        </div>
        <div id="final-feedback-overlay" class="hidden">
          <div id="final-feedback-text"></div>
          <button id="next-patient-button">Next Patient</button>
        </div>
      </div>
      <div id="lab-canvas-container" class="lab-canvas-container"></div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/three@0.166.1/build/three.min.js"></script>
    <script>
      // Initial Welcome Overlay
      document.addEventListener("DOMContentLoaded", () => {
        const initialWelcomeOverlay = document.getElementById(
          "initial-welcome-overlay"
        );
        const enterSiteButton = document.getElementById("enter-site-button");
        const batSound = document.getElementById("bat-sound");

        enterSiteButton.addEventListener("click", () => {
          initialWelcomeOverlay.classList.add("hidden");
          if (batSound) {
            batSound
              .play()
              .catch((e) => console.error("Audio play failed:", e));
            batSound.volume = 0.3;
          }
        });
      });

      // Sound Toggle Button
      const soundToggleButton = document.getElementById("sound-toggle-button");
      const soundOnIcon = document.getElementById("sound-on-icon");
      const soundOffIcon = document.getElementById("sound-off-icon");
      const batSound = document.getElementById("bat-sound");
      const chimeSound = document.getElementById("chime-sound");
      const typingSound = document.getElementById("typing-sound");
      const evilLaughSound = document.getElementById("evil-laugh-sound");
      const wolfHowlSound = document.getElementById("wolf-howl-sound");

      let isSoundOn = false;

      soundToggleButton.addEventListener("click", () => {
        if (isSoundOn) {
          if (batSound) batSound.pause();
          if (chimeSound) chimeSound.pause();
          if (typingSound) typingSound.pause();
          if (evilLaughSound) evilLaughSound.pause();
          if (wolfHowlSound) wolfHowlSound.pause();
          soundOnIcon.style.display = "none";
          soundOffIcon.style.display = "block";
        } else {
          if (batSound)
            batSound
              .play()
              .catch((e) => console.error("Audio play failed:", e));
          soundOnIcon.style.display = "block";
          soundOffIcon.style.display = "none";
        }
        isSoundOn = !isSoundOn;
      });

      // Bat animation
      const batContainer = document.getElementById("bat-container");

      const createBat = () => {
        const bat = document.createElement("img");
        bat.src = "halloween-flying-bat-sticker-u889c-x450.png";
        bat.alt = "bat";
        bat.classList.add("bat");
        batContainer.appendChild(bat);

        const startY = Math.random() * (window.innerHeight * 0.8);
        const midY = Math.random() * (window.innerHeight * 0.8);
        const endY = Math.random() * (window.innerHeight * 0.8);
        const duration = Math.random() * 10 + 5;
        const direction = Math.random() > 0.5 ? "right" : "left";

        bat.style.setProperty("--startY", `${startY}px`);
        bat.style.setProperty("--midY", `${midY}px`);
        bat.style.setProperty("--endY", `${endY}px`);

        bat.style.animation = `${
          direction === "right" ? "flyToRight" : "flyToLeft"
        } ${duration}s linear forwards`;

        bat.addEventListener("animationend", () => {
          bat.remove();
        });
      };

      setInterval(createBat, 3000); // Create a new bat every 3 seconds

      // Mouse Glow
      const mouseGlow = document.getElementById("mouse-glow");

      document.addEventListener("mousemove", (e) => {
        mouseGlow.style.left = `${e.clientX}px`;
        mouseGlow.style.top = `${e.clientY}px`;
        mouseGlow.style.opacity = 1;
      });

      document.addEventListener("mouseleave", () => {
        mouseGlow.style.opacity = 0;
      });

      // Mist Overlay
      const mistOverlay = document.getElementById("mist-overlay");

      let mistInterval;

      // Function to show mist
      function showMist() {
        mistOverlay.style.height = "25%"; // Adjust as needed
        clearInterval(mistInterval); // Clear any existing interval
        mistInterval = setInterval(hideMist, 10000); // Hide after 10 seconds
      }

      // Function to hide mist
      function hideMist() {
        mistOverlay.style.height = "0";
        clearInterval(mistInterval); // Clear interval after hiding
        mistInterval = setInterval(showMist, 20000); // Show again after 20 seconds
      }

      // Start the mist cycle
      setInterval(showMist, 15000); // Initial show after 15 seconds

      // Blood drop on click
      document.addEventListener("click", (e) => {
        const bloodDrop = document.createElement("div");
        bloodDrop.classList.add("blood-drop");
        bloodDrop.style.left = `${e.clientX}px`;
        bloodDrop.style.top = `${e.clientY}px`;
        document.body.appendChild(bloodDrop);

        // Play drip sound
        if (dripSound && isSoundOn) {
          dripSound.currentTime = 0; // Rewind to start
          dripSound.play().catch((e) => console.error("Drip sound failed:", e));
        }

        bloodDrop.addEventListener("animationend", () => {
          bloodDrop.remove();
        });
      });

      // Section visibility logic
      const sections = document.querySelectorAll("section");
      const navLinks = document.querySelectorAll("nav a");

      // Function to show only the active section and hide others
      function showSection(id) {
        sections.forEach((section) => {
          if (section.id === id) {
            section.style.display = "block";
          } else {
            section.style.display = "none";
          }
        });
      }

      // Handle navigation clicks
      navLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          const targetId = e.target.closest("a").getAttribute("href").substring(1);
          showSection(targetId);

          // Scroll to the top of the displayed section if it's not the initial load
          const targetSection = document.getElementById(targetId);
          if (targetSection) {
            targetSection.scrollIntoView({ behavior: "smooth" });
          }
        });
      });

      // Show home section on initial load or if no hash
      const initialHash = window.location.hash.substring(1);
      if (initialHash && document.getElementById(initialHash)) {
        showSection(initialHash);
      } else {
        showSection("home");
      }

      // Scroll to top when game.html is linked
      document.querySelector('a[href="game.html"]').addEventListener("click", (e) => {
        e.preventDefault(); // Prevent default link behavior
        const labContainer = document.getElementById("lab-container");
        if (labContainer) {
          labContainer.style.display = "block";
          document.body.style.overflow = "hidden"; // Prevent scrolling on main page
          initThreeJS(); // Initialize the 3D game
        }
      });

      document.getElementById("close-lab").addEventListener("click", () => {
        const labContainer = document.getElementById("lab-container");
        if (labContainer) {
          labContainer.style.display = "none";
          document.body.style.overflow = "auto"; // Re-enable scrolling on main page
        }
      });

      // Letter generation (simplified)
      function submitDonor() {
        const name = document.getElementById("name").value;
        const group = document.getElementById("group").value;
        const outputDiv = document.getElementById("output");
        const typingSpeed = 50; // milliseconds per character
        let charIndex = 0;

        const letterContent = `
Dear Mr./Ms. ${name},

We are thrilled to welcome you to the Transylvania Blood Network. Your generous offer to donate blood of type ${group} is greatly appreciated.

Your contribution is vital to maintaining the delicate balance within our ancient community. Rest assured, your essence will be used for the noblest of causes.

We look forward to your visit under the crimson moon.

With eternal gratitude,
The Elders of Transylvania Blood Network
      `;

        outputDiv.innerHTML = ""; // Clear previous content

        if (chimeSound && isSoundOn) {
          chimeSound.currentTime = 0;
          chimeSound.play().catch((e) => console.error("Chime sound failed:", e));
        }

        if (typingSound && isSoundOn) {
          typingSound.loop = true;
          typingSound.play().catch((e) => console.error("Typing sound failed:", e));
        }

        function typeCharacter() {
          if (charIndex < letterContent.length) {
            outputDiv.innerHTML += letterContent.charAt(charIndex);
            charIndex++;
            setTimeout(typeCharacter, typingSpeed);
          } else {
            if (typingSound) typingSound.pause(); // Stop typing sound
            outputDiv.innerHTML += `<span class="typing-cursor"></span>`; // Add blinking cursor at the end
          }
        }
        typeCharacter();
      }

      // Donor list and inventory (Local Storage)
      let donors = JSON.parse(localStorage.getItem("donors")) || [];

      function saveDonors() {
        localStorage.setItem("donors", JSON.stringify(donors));
      }

      function renderDonors() {
        const donorList = document.getElementById("donor-list");
        const noDonorsMessage = document.getElementById("no-donors-message");
        donorList.innerHTML = "";

        if (donors.length === 0) {
          noDonorsMessage.style.display = "block";
        } else {
          noDonorsMessage.style.display = "none";
          donors.forEach((donor, index) => {
            const li = document.createElement("li");
            li.style.cssText = `
              background-color: rgba(42, 42, 42, 0.7);
              padding: 10px;
              margin-bottom: 8px;
              border-radius: 5px;
              border: 1px solid #550000;
              display: flex;
              justify-content: space-between;
              align-items: center;
              color: #ccc;
            `;
            li.innerHTML = `
              <span>${donor.name} (${donor.group})</span>
              <button onclick="removeDonor(${index})" style="
                background-color: #800000;
                color: #f5f5f5;
                padding: 5px 10px;
                border: none;
                border-radius: 3px;
                cursor: pointer;
                width: auto;
                margin-top: 0;
                font-size: 0.8em;
              ">Remove</button>
            `;
            donorList.appendChild(li);
          });
        }
        updateBloodInventory();
      }

      function addDonor(name, group) {
        donors.push({ name, group });
        saveDonors();
        renderDonors();
      }

      function removeDonor(index) {
        donors.splice(index, 1);
        saveDonors();
        renderDonors();
      }

      function clearAllDonors() {
        if (confirm("Are you sure you want to clear all registered donors?")) {
          donors = [];
          saveDonors();
          renderDonors();
        }
      }

      function updateBloodInventory() {
        const inventory = {};
        donors.forEach((donor) => {
          inventory[donor.group] = (inventory[donor.group] || 0) + 1;
        });

        const inventorySummary = document.getElementById("inventory-summary");
        if (Object.keys(inventory).length === 0) {
          inventorySummary.textContent = "No blood data available.";
        } else {
          let summaryHtml = "<ul>";
          for (const group in inventory) {
            summaryHtml += `<li>${group}: ${inventory[group]} bags</li>`;
          }
          summaryHtml += "</ul>";
          inventorySummary.innerHTML = summaryHtml;
        }
      }

      // Random Vampire Fact
      const vampireFacts = [
        "Vampires are mythical beings who subsist by feeding on the life essence (generally blood) of living creatures.",
        "The most famous vampire is Count Dracula from Bram Stoker's 1897 novel 'Dracula'.",
        "Folklore vampires often had bloated, ruddy, or dark complexions, unlike the pale, aristocratic vampires of modern fiction.",
        "To ward off vampires in some legends, people would scatter seeds or grains on a grave, believing the vampire would be compelled to count every piece.",
        "The word 'vampire' entered the English language in 1734, after an influx of vampire superstitions in Eastern Europe.",
        "Garlic is a common deterrent against vampires in folklore, possibly due to its strong smell.",
        "Some cultures believed that a person could become a vampire if they were excommunicated from the church or committed suicide.",
        "The first known literary work to feature a vampire was 'The Vampyre' by John Polidori, published in 1819.",
      ];

      function displayRandomVampireFact() {
        const output = document.getElementById("vampire-fact-output");
        const randomIndex = Math.floor(Math.random() * vampireFacts.length);
        output.textContent = vampireFacts[randomIndex];
        if (wolfHowlSound && isSoundOn) {
          wolfHowlSound.currentTime = 0;
          wolfHowlSound.play().catch((e) => console.error("Wolf howl failed:", e));
        }
      }

      // Blood Type Craving Compatibility
      const bloodCravings = {
        "A+": "A craving for structured, organized meals. Perhaps a perfectly rare steak?",
        "A-": "A desire for ancient, earthy flavors. You might find yourself drawn to aged wines or rich, gamey dishes.",
        "B+": "A flexible palate, open to new and exotic tastes. A journey to a distant land's culinary delights might be in order.",
        "B-": "An independent craving, not bound by convention. Perhaps a quest for unique, undiscovered sources of sustenance.",
        "AB+": "A balanced hunger, appreciating both light and dark. A blend of sweet and savory might satisfy your complex desires.",
        "AB-": "A mysterious craving for the rare and unusual. You might be drawn to the forbidden or the exceptionally scarce.",
        "O+": "A primal urge for hearty, fundamental sustenance. The raw power of nature's bounty calls to you.",
        "O-": "The universal craving. You might feel a profound connection to the essence of all life, seeking its purest form.",
      };

      function getBloodCraving() {
        const selectedGroup = document.getElementById("craving-group").value;
        const output = document.getElementById("craving-output");
        output.textContent = bloodCravings[selectedGroup];
        if (evilLaughSound && isSoundOn) {
          evilLaughSound.currentTime = 0;
          evilLaughSound
            .play()
            .catch((e) => console.error("Evil laugh failed:", e));
        }
      }

      // Call renderDonors on load
      document.addEventListener("DOMContentLoaded", renderDonors);

      // Catch Vlad Game Logic
      const gameArea = document.getElementById("game-area");
      const scoreDisplay = document.getElementById("score-display");
      const timerDisplay = document.getElementById("timer-display");
      const gameStartButton = document.getElementById("game-start-button");

      let score = 0;
      let timeLeft = 30;
      let gameInterval;
      let timerInterval;
      let gameActive = false;
      let currentVlad = null;

      function createVlad() {
        if (!gameActive) return;

        // Remove previous Vlad if exists
        if (currentVlad) {
          currentVlad.remove();
          currentVlad = null;
        }

        const vlad = document.createElement("img");
        vlad.src = "vlad.png"; // Replace with your Vlad image
        vlad.alt = "Vlad Tepes";
        vlad.classList.add("game-bat");

        const gameAreaWidth = gameArea.clientWidth;
        const gameAreaHeight = gameArea.clientHeight;

        const vladWidth = 80; // from CSS
        const vladHeight = 80; // approximate height for positioning

        const randomX = Math.random() * (gameAreaWidth - vladWidth);
        const randomY = Math.random() * (gameAreaHeight - vladHeight);

        vlad.style.left = `${randomX}px`;
        vlad.style.top = `${randomY}px`;

        vlad.addEventListener("click", () => {
          if (gameActive) {
            score++;
            scoreDisplay.textContent = `Score: ${score}`;
            vlad.remove(); // Remove clicked Vlad
            currentVlad = null;
            // Instantly create a new Vlad for faster gameplay
            setTimeout(createVlad, 200); // Small delay before new Vlad appears
          }
        });

        gameArea.appendChild(vlad);
        currentVlad = vlad; // Keep track of the current Vlad

        // Make Vlad disappear after a short time if not clicked
        setTimeout(() => {
          if (vlad === currentVlad) {
            vlad.remove();
            currentVlad = null;
          }
        }, 1500); // Vlad disappears after 1.5 seconds if not clicked
      }

      function startGame() {
        score = 0;
        timeLeft = 30;
        gameActive = true;
        scoreDisplay.textContent = `Score: ${score}`;
        timerDisplay.textContent = `Time: ${timeLeft}s`;
        gameStartButton.textContent = "Game In Progress...";
        gameStartButton.disabled = true;
        gameStartButton.classList.add("disabled");

        // Clear any existing Vlads
        gameArea.innerHTML = "";

        gameInterval = setInterval(createVlad, 1000); // Create Vlad every second
        timerInterval = setInterval(updateGameTimer, 1000);
      }

      function updateGameTimer() {
        timeLeft--;
        timerDisplay.textContent = `Time: ${timeLeft}s`;

        if (timeLeft <= 0) {
          endGame();
        }
      }

      function endGame() {
        gameActive = false;
        clearInterval(gameInterval);
        clearInterval(timerInterval);

        if (currentVlad) {
          currentVlad.remove(); // Remove any remaining Vlad
          currentVlad = null;
        }

        gameStartButton.textContent = "Start Game!";
        gameStartButton.disabled = false;
        gameStartButton.classList.remove("disabled");

        alert(`Game Over! Your final score is: ${score}`);
      }

      gameStartButton.addEventListener("click", startGame);

      // Vampire Quiz Logic
      const quizQuestions = [
        {
          question: "Which blood type is considered the 'universal donor' for red blood cells?",
          options: ["A+", "B-", "O-", "AB+"],
          answer: "O-",
        },
        {
          question: "What is a common traditional method to kill a vampire?",
          options: ["Silver bullet", "Sunlight", "Wooden stake through the heart", "Holy water"],
          answer: "Wooden stake through the heart",
        },
        {
          question: "In Bram Stoker's Dracula, where is Count Dracula's castle located?",
          options: ["Transylvania", "London", "Paris", "Venice"],
          answer: "Transylvania",
        },
        {
          question: "Which of these is NOT a traditional vampire weakness?",
          options: ["Garlic", "Crossing running water", "Mirrors", "Chocolate"],
          answer: "Chocolate",
        },
        {
          question: "What animal is most commonly associated with vampires?",
          options: ["Wolf", "Bat", "Owl", "Spider"],
          answer: "Bat",
        },
        {
          question: "What fictional character is often considered the first modern vampire in literature?",
          options: ["Dracula", "Carmilla", "Lord Ruthven", "Lestat"],
          answer: "Lord Ruthven",
        },
        {
          question: "Which metal is sometimes believed to harm vampires?",
          options: ["Gold", "Silver", "Iron", "Copper"],
          answer: "Silver",
        },
        {
          question: "Vampire folklore originated predominantly in which region?",
          options: ["Western Europe", "Eastern Europe", "Africa", "Asia"],
          answer: "Eastern Europe",
        },
        {
          question: "What time of day are vampires typically weakest or forced to hide?",
          options: ["Midnight", "Dawn", "Dusk", "Noon"],
          answer: "Dawn",
        },
        {
          question: "Which fictional character is a famous vampire hunter?",
          options: ["Sherlock Holmes", "Van Helsing", "Dr. Jekyll", "Frankenstein"],
          answer: "Van Helsing",
        },
      ];

      let currentQuestionIndex = 0;
      let quizScore = 0;
      const userAnswers = new Array(quizQuestions.length).fill(null);

      const quizContainer = document.getElementById("quiz-container");
      const quizProgress = document.getElementById("quiz-progress");
      const prevQuestionBtn = document.getElementById("prev-question");
      const nextQuestionBtn = document.getElementById("next-question");
      const submitQuizBtn = document.getElementById("submit-quiz");
      const quizResultDiv = document.getElementById("quiz-result");
      const resultDescriptionDiv = document.getElementById("result-description");

      function loadQuestion() {
        const q = quizQuestions[currentQuestionIndex];
        quizContainer.innerHTML = `
          <div class="quiz-question">
            <p>${currentQuestionIndex + 1}. ${q.question}</p>
            <div class="quiz-options">
              ${q.options
            .map(
              (option, i) => `
                <label>
                  <input type="radio" name="question${currentQuestionIndex}" value="${option}" ${userAnswers[currentQuestionIndex] === option ? "checked" : ""}>
                  ${option}
                </label>
              `
            )
            .join("")}
            </div>
          </div>
        `;

        quizProgress.textContent = `Question ${currentQuestionIndex + 1} of ${quizQuestions.length}`;

        // Update button visibility
        prevQuestionBtn.style.display = currentQuestionIndex > 0 ? "inline-block" : "none";
        nextQuestionBtn.style.display = currentQuestionIndex < quizQuestions.length - 1 ? "inline-block" : "none";
        submitQuizBtn.style.display = currentQuestionIndex === quizQuestions.length - 1 ? "inline-block" : "none";

        // Add event listeners for radio buttons to save answers
        quizContainer.querySelectorAll(`input[name="question${currentQuestionIndex}"]`).forEach(radio => {
          radio.addEventListener('change', (event) => {
            userAnswers[currentQuestionIndex] = event.target.value;
          });
        });
      }

      function navigateQuiz(direction) {
        // Save current answer before navigating
        const selectedOption = quizContainer.querySelector(`input[name="question${currentQuestionIndex}"]:checked`);
        if (selectedOption) {
          userAnswers[currentQuestionIndex] = selectedOption.value;
        }

        currentQuestionIndex += direction;
        if (currentQuestionIndex < 0) {
          currentQuestionIndex = 0;
        } else if (currentQuestionIndex >= quizQuestions.length) {
          currentQuestionIndex = quizQuestions.length - 1;
        }
        loadQuestion();
      }

      prevQuestionBtn.addEventListener("click", () => navigateQuiz(-1));
      nextQuestionBtn.addEventListener("click", () => navigateQuiz(1));

      submitQuizBtn.addEventListener("click", () => {
        // Save current answer before submitting
        const selectedOption = quizContainer.querySelector(`input[name="question${currentQuestionIndex}"]:checked`);
        if (selectedOption) {
          userAnswers[currentQuestionIndex] = selectedOption.value;
        }

        quizScore = 0;
        userAnswers.forEach((answer, index) => {
          if (answer === quizQuestions[index].answer) {
            quizScore++;
          }
        });

        quizResultDiv.textContent = `You scored ${quizScore} out of ${quizQuestions.length}!`;

        let description = "";
        if (quizScore <= 3) {
          description = "You're a human, perhaps a tasty snack for a vampire. Stay safe!";
        } else if (quizScore <= 6) {
          description = "You're half-human, half-vampire. The struggle is real, isn't it?";
        } else if (quizScore <= 9) {
          description = "You're almost a full-fledged creature of the night! Embrace your destiny.";
        } else {
          description = "You are the true Vampire Lord/Lady! All shall bow before your knowledge!";
        }
        resultDescriptionDiv.textContent = description;

        // Hide quiz navigation and show results
        quizContainer.style.display = "none";
        quizProgress.style.display = "none";
        prevQuestionBtn.style.display = "none";
        nextQuestionBtn.style.display = "none";
        submitQuizBtn.style.display = "none";
        quizResultDiv.style.display = "block";
        resultDescriptionDiv.style.display = "block";
      });

      // Initialize quiz
      document.addEventListener("DOMContentLoaded", () => {
        // Only load quiz if the section is visible
        if (document.getElementById('vampire-quiz').style.display !== 'none') {
          loadQuestion();
        }
      });

      // Countdown Timer
      const daysSpan = document.getElementById("days");
      const hoursSpan = document.getElementById("hours");
      const minutesSpan = document.getElementById("minutes");
      const secondsSpan = document.getElementById("seconds");
      const countdownMessage = document.getElementById("countdown-message");

      let countdownDate;
      let countdownInterval;

      function setCountdownDate(targetDate) {
        countdownDate = targetDate;
        localStorage.setItem("countdownTarget", targetDate.toISOString());
        startCountdown();
        countdownMessage.textContent = "Your mystical transformation countdown has begun!";
      }

      function startCountdown() {
        clearInterval(countdownInterval); // Clear any existing interval

        countdownInterval = setInterval(() => {
          const now = new Date().getTime();
          const distance = countdownDate - now;

          if (distance < 0) {
            clearInterval(countdownInterval);
            daysSpan.textContent = "00";
            hoursSpan.textContent = "00";
            minutesSpan.textContent = "00";
            secondsSpan.textContent = "00";
            countdownMessage.textContent = "The transformation is complete! Welcome to the night!";
            countdownMessage.classList.add("countdown-finished");
            return;
          }

          const days = Math.floor(distance / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
          );
          const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((distance % (1000 * 60)) / 1000);

          daysSpan.textContent = String(days).padStart(2, "0");
          hoursSpan.textContent = String(hours).padStart(2, "0");
          minutesSpan.textContent = String(minutes).padStart(2, "0");
          secondsSpan.textContent = String(seconds).padStart(2, "0");
        }, 1000);
      }

      // Load saved countdown target on page load
      document.addEventListener("DOMContentLoaded", () => {
        const savedTarget = localStorage.getItem("countdownTarget");
        if (savedTarget) {
          countdownDate = new Date(savedTarget);
          if (countdownDate > new Date()) {
            startCountdown();
            countdownMessage.textContent = "Your mystical transformation countdown is active!";
          } else {
            countdownMessage.textContent = "The transformation is complete! Welcome to the night!";
            countdownMessage.classList.add("countdown-finished");
          }
        } else {
          countdownMessage.textContent = "Register as a donor to begin your mystical transformation countdown...";
        }
      });

      function startDemoCountdown() {
        const oneMinuteFromNow = new Date(new Date().getTime() + 60 * 1000); // 1 minute from now
        setCountdownDate(oneMinuteFromNow);
      }

      // Contact Form Submission
      const contactForm = document.getElementById("contact-form");
      const contactSuccessMessage = document.getElementById("contact-success-message");

      contactForm.addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent default form submission

        // In a real application, you would send this data to a server
        // For this demo, we'll just show a success message
        console.log("Contact form submitted!");
        console.log("Name:", document.getElementById("contact-name").value);
        console.log("Email:", document.getElementById("contact-email").value);
        console.log("Message:", document.getElementById("contact-message").value);

        contactSuccessMessage.textContent = "Message sent successfully! We'll be in touch... eventually.";
        contactSuccessMessage.style.display = "block";
        contactForm.reset(); // Clear the form

        setTimeout(() => {
          contactSuccessMessage.style.display = "none";
        }, 5000); // Hide message after 5 seconds
      });

      // Donation Confirmation Box
      const donationConfirmationBox = document.getElementById("donation-confirmation-box");
      let donationTimer;

      // Function to show the donation confirmation
      function showDonationConfirmation() {
        clearTimeout(donationTimer); // Clear any existing timer
        donationConfirmationBox.classList.add("show");

        donationTimer = setTimeout(() => {
          donationConfirmationBox.classList.remove("show");
        }, 5000); // Hide after 5 seconds
      }

      // Example of triggering the donation confirmation (you can call this from your donor submission)
      // For demonstration, let's show it briefly on page load (can be removed)
      // document.addEventListener("DOMContentLoaded", showDonationConfirmation);

      // --- 3D Lab Game Logic (Three.js) ---
      const labContainer = document.getElementById("lab-container");
      const labCanvasContainer = document.getElementById("lab-canvas-container");
      const instructions = document.getElementById("instructions");
      const confirmationWrapper = document.getElementById("confirmation-wrapper");
      const bloodTypeSelect = document.getElementById("blood-type-select");
      const confirmTypeButton = document.getElementById("confirm-type-button");
      const finalFeedbackOverlay = document.getElementById("final-feedback-overlay");
      const finalFeedbackText = document.getElementById("final-feedback-text");
      const nextPatientButton = document.getElementById("next-patient-button");

      let scene, camera, renderer, syringe, arm, currentBloodType, controls;
      let raycaster, mouse;
      let currentPatient = 0;
      const patientData = [
        { type: "A+", instructions: "Collect Type A+ blood." },
        { type: "O-", instructions: "Collect Type O- blood." },
        { type: "B+", instructions: "Collect Type B+ blood." },
        { type: "AB-", instructions: "Collect Type AB- blood." },
        // Add more patients as needed
      ];

      function initThreeJS() {
        if (renderer) {
          // If already initialized, just reset for a new game
          resetLabScene();
          return;
        }

        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 0); // Transparent background
        labCanvasContainer.appendChild(renderer.domElement);

        // Lights
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 10, 5).normalize();
        scene.add(directionalLight);

        // Arm (simple cylinder for now)
        const armGeometry = new THREE.CylinderGeometry(0.5, 0.7, 3, 32);
        const armMaterial = new THREE.MeshStandardMaterial({ color: 0xaa6666 });
        arm = new THREE.Mesh(armGeometry, armMaterial);
        arm.position.set(0, 0, 0); // Center the arm
        scene.add(arm);

        // Syringe (simple cylinder + cone)
        const syringeBodyGeometry = new THREE.CylinderGeometry(0.05, 0.07, 1.5, 16);
        const syringeBodyMaterial = new THREE.MeshStandardMaterial({ color: 0xcccccc });
        const syringeBody = new THREE.Mesh(syringeBodyGeometry, syringeBodyMaterial);
        syringeBody.position.set(0, 0, 0);

        const syringeNeedleGeometry = new THREE.ConeGeometry(0.03, 0.3, 16);
        const syringeNeedleMaterial = new THREE.MeshStandardMaterial({ color: 0xaaaaaa });
        const syringeNeedle = new THREE.Mesh(syringeNeedleGeometry, syringeNeedleMaterial);
        syringeNeedle.position.set(0, 0.9, 0); // Position needle at top of body

        syringe = new THREE.Group();
        syringe.add(syringeBody);
        syringe.add(syringeNeedle);

        syringe.position.set(3, 0, 0); // Initial position for syringe
        scene.add(syringe);

        camera.position.z = 5;
        camera.position.y = 1;

        // OrbitControls for interaction
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // an animation loop is required when damping is enabled
        controls.dampingFactor = 0.25;
        controls.screenSpacePanning = false;
        controls.maxPolarAngle = Math.PI / 2;
        controls.minDistance = 3;
        controls.maxDistance = 10;
        controls.target.set(0, 0, 0); // Focus on the arm

        // Raycaster for click detection on syringe (if needed)
        raycaster = new THREE.Raycaster();
        mouse = new THREE.Vector2();

        animate();

        window.addEventListener("resize", onWindowResize);
        labCanvasContainer.addEventListener("mousemove", onMouseMove);
        labCanvasContainer.addEventListener("mouseup", onMouseUp);

        resetLabScene();
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      let isDraggingSyringe = false;
      const syringeOffset = new THREE.Vector3();

      function onMouseMove(event) {
        if (!isDraggingSyringe) return;

        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);

        const plane = new THREE.Plane(new THREE.Vector3(0, 0, 1), 0); // XY plane
        const intersection = new THREE.Vector3();
        raycaster.ray.intersectPlane(plane, intersection);

        syringe.position.copy(intersection.sub(syringeOffset));
      }

      function onMouseDown(event) {
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);

        const intersects = raycaster.intersectObjects([syringe], true);

        if (intersects.length > 0) {
          isDraggingSyringe = true;
          controls.enabled = false; // Disable orbit controls during drag

          const plane = new THREE.Plane(new THREE.Vector3(0, 0, 1), 0);
          const intersection = new THREE.Vector3();
          raycaster.ray.intersectPlane(plane, intersection);
          syringeOffset.copy(intersection).sub(syringe.position);

          // Change cursor
          labCanvasContainer.style.cursor = "grabbing";
        }
      }

      function onMouseUp() {
        if (isDraggingSyringe) {
          isDraggingSyringe = false;
          controls.enabled = true; // Re-enable orbit controls
          labCanvasContainer.style.cursor = "grab";

          // Check for collision with arm
          const syringeBoundingBox = new THREE.Box3().setFromObject(syringe);
          const armBoundingBox = new THREE.Box3().setFromObject(arm);

          if (syringeBoundingBox.intersectsBox(armBoundingBox)) {
            handleBloodCollection();
          }
        }
      }

      function handleBloodCollection() {
        instructions.textContent = "Blood collected! Now identify the type.";
        controls.enabled = false; // Disable controls after collection
        labCanvasContainer.removeEventListener("mousedown", onMouseDown); // Stop dragging

        // Show confirmation and blood type selection
        confirmationWrapper.classList.remove("hidden");
        populateBloodTypeSelect();
      }

      function populateBloodTypeSelect() {
        bloodTypeSelect.innerHTML = "";
        const types = ["A+", "A-", "B+", "B-", "AB+", "AB-", "O+", "O-"];
        types.forEach(type => {
          const option = document.createElement("option");
          option.value = type;
          option.textContent = type;
          bloodTypeSelect.appendChild(option);
        });
      }

      confirmTypeButton.addEventListener("click", () => {
        const selectedType = bloodTypeSelect.value;
        if (selectedType === currentBloodType) {
          showFinalFeedback(true, "Success!", "Blood type matched! Patient saved!");
        } else {
          showFinalFeedback(false, "Failure!", `Incorrect type! This patient needed ${currentBloodType}.`);
        }
        confirmationWrapper.classList.add("hidden");
      });

      function showFinalFeedback(isSuccess, title, message) {
        finalFeedbackOverlay.classList.remove("hidden");
        finalFeedbackOverlay.classList.toggle("success", isSuccess);
        finalFeedbackOverlay.classList.toggle("error", !isSuccess);
        finalFeedbackText.innerHTML = `<h2>${title}</h2><p>${message}</p>`;
      }

      nextPatientButton.addEventListener("click", () => {
        currentPatient++;
        if (currentPatient >= patientData.length) {
          finalFeedbackText.innerHTML = "<h2>All Patients Treated!</h2><p>You've done well, Doctor!</p>";
          nextPatientButton.style.display = "none";
          // Optionally, add a "Restart Game" button here
          setTimeout(() => {
            resetLabScene();
            currentPatient = 0; // Reset for a new cycle
          }, 3000); // Wait a bit before resetting fully
          return;
        }
        resetLabScene();
      });

      function resetLabScene() {
        finalFeedbackOverlay.classList.add("hidden");
        instructions.textContent = patientData[currentPatient].instructions;
        currentBloodType = patientData[currentPatient].type;

        // Reset syringe position
        if (syringe) {
          syringe.position.set(3, 0, 0);
        }

        // Re-enable interactions
        labCanvasContainer.style.cursor = "grab";
        controls.enabled = true;
        labCanvasContainer.addEventListener("mousedown", onMouseDown);
        nextPatientButton.style.display = "inline-block"; // Ensure it's visible for subsequent patients
      }

      function animate() {
        requestAnimationFrame(animate);
        controls.update(); // only required if controls.enableDamping is set to true
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
