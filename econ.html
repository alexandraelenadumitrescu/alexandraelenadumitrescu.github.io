<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAT GAP 2023 - Interactive Workflow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            overflow-x: hidden;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .instructions {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Container for the graph */
        .mermaid-container {
            display: flex;
            justify-content: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* --- INTERACTIVITY STYLES --- */
        
        /* Cursor pointer for nodes */
        g.node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* Completed State (Green) */
        /* We target the shapes inside the node (rect, polygon, circle) */
        g.node.completed > :is(rect, circle, polygon, path) {
            fill: #4caf50 !important; /* Green */
            stroke: #2e7d32 !important; /* Dark Green Border */
            stroke-width: 3px !important;
        }

        /* Change text color in completed nodes if needed */
        g.node.completed .nodeLabel {
            font-weight: bold; 
        }

        /* --- DRAWER / POST-IT STYLES --- */
        #drawer {
            position: fixed;
            top: 0;
            right: -400px; /* Hidden by default */
            width: 350px;
            height: 100vh;
            background: #fff9c4; /* Post-it Yellow */
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
            transition: right 0.3s ease-in-out;
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        #drawer.open {
            right: 0;
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f0e68c;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .drawer-header h2 {
            margin: 0;
            font-size: 1.2rem;
            color: #555;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #555;
        }

        .drawer-content {
            flex-grow: 1;
        }

        .node-content-display {
            background: rgba(255,255,255,0.5);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #333;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid #dcdcdc;
            border-radius: 5px;
            font-family: inherit;
            resize: vertical;
            background: #fff;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            display: none;
            z-index: 999;
        }

        .overlay.active {
            display: block;
        }

    </style>
</head>
<body>

    <h1>Research Workflow: VAT GAP 2023</h1>
    
    <div class="instructions">
        <strong>üëÜ Single Click:</strong> Mark as Completed (Green)<br>
        <strong>‚úåÔ∏è Double Click:</strong> Open Notes / Details
    </div>

    <div class="mermaid-container">
        <div class="mermaid">
graph TD
    A[TEMA: GAP TVA 2023 √Æn UE] --> B[1. FUNDAMENTARE TEORETICƒÇ]
    
    B --> B1[CautƒÉ 5-10 articole recente<br/>2020-2025 despre:]
    B1 --> B1a[‚Ä¢ VAT gap determinants]
    B1 --> B1b[‚Ä¢ Shadow economy & tax evasion]
    B1 --> B1c[‚Ä¢ Digitalization impact on tax compliance]
    B1 --> B1d[‚Ä¢ EU tax administration efficiency]
    
    B1 --> C[2. COLECTARE & PREGƒÇTIRE DATE]
    
    C --> C1[Variabila DEPENDENTƒÇ:<br/>VAT_GAP_2023]
    C --> C2[Variabile INDEPENDENTE]
    
    C2 --> C2a[SHADOW_ECONOMY<br/>% din PIB - 2023]
    C2 --> C2b[DIGI_DUMMY<br/>digitalizare timpurie]
    C2 --> C2c[Alte variabile de control]
    
    C2c --> C2c1[‚Ä¢ GDP_per_capita]
    C2c --> C2c2[‚Ä¢ Tax_administration_quality]
    C2c --> C2c3[‚Ä¢ Corruption_index]
    C2c --> C2c4[‚Ä¢ Digital_infrastructure]
    
    C --> D[3. EXPLORATORY DATA ANALYSIS]
    
    D --> D1[Statistici descriptive<br/>mean, sd, min, max, skewness]
    D --> D2[VizualizƒÉri]
    D --> D3[Matrice de corela»õii]
    
    D2 --> D2a[‚Ä¢ Histograme pentru distribu»õii]
    D2 --> D2b[‚Ä¢ Scatter plots VAT_GAP vs predictori]
    D2 --> D2c[‚Ä¢ Boxplots pe grup DIGI_DUMMY]
    
    D --> E[4. √éMPƒÇR»öIRE TRAIN/TEST]
    E --> E1[70-80% TRAIN<br/>20-30% TEST]
    
    E --> F[5. MODELUL DE BAZƒÇ - OLS]
    
    F --> F1[VAT_GAP = Œ≤0 + Œ≤1¬∑SHADOW_ECONOMY<br/>+ Œ≤2¬∑DIGI_DUMMY + Œ≤3¬∑CONTROLS + Œµ]
    
    F1 --> G[6. VALIDƒÇRI OBLIGATORII]
    
    G --> G1[A. SEMNIFICA»öIE STATISTICƒÇ]
    G1 --> G1a[t-test pentru fiecare Œ≤<br/>‚úì p-value < 0.05 sau 0.10]
    G1 --> G1b[F-test global<br/>‚úì modelul e semnificativ]
    
    G --> G2[B. BONITATEA MODELULUI]
    G2 --> G2a[R¬≤ »ôi R¬≤_adjusted<br/>‚úì c√¢t din varia»õie explicƒÉ]
    G2 --> G2b[AIC / BIC<br/>‚úì pentru compara»õii]
    
    G --> G3[C. IPOTEZE CLASICE OLS]
    
    G3 --> H1[TEST 1: NORMALITATE]
    H1 --> H1a[Shapiro-Wilk test pe reziduuri]
    H1 --> H1b[Q-Q plot vizual]
    H1 --> H1c[‚ö†Ô∏è DacƒÉ RESPINS: n mare salveazƒÉ<br/>prin CLT, altfel transformƒÉri]
    
    G3 --> H2[TEST 2: HOMOSCEDASTICITATE]
    H2 --> H2a[Breusch-Pagan test]
    H2 --> H2b[White test]
    H2 --> H2c[Plot reziduuri vs fitted]
    H2 --> H2d[‚ö†Ô∏è DacƒÉ RESPINS:<br/>Corec»õie HC robust std errors]
    
    G3 --> H3[TEST 3: MULTICOLINIARITATE]
    H3 --> H3a[VIF pentru fiecare predictor]
    H3 --> H3b[‚úì VIF < 5 OK<br/>‚ö†Ô∏è VIF > 10 PROBLEMƒÇ]
    H3 --> H3c[DacƒÉ problemƒÉ:<br/>eliminƒÉ variabile corelate<br/>sau centreazƒÉ datele]
    
    G3 --> H4[TEST 4: OUTLIERI & INFLUEN»öƒÇ]
    H4 --> H4a[Cook's Distance > 1]
    H4 --> H4b[Leverage > 2k/n]
    H4 --> H4c[Studentized residuals]
    H4 --> H4d[‚ö†Ô∏è DacƒÉ detectat:<br/>investigheazƒÉ & eventual exclude]
    
    G3 --> H5[TEST 5: SPECIFICA»öIE]
    H5 --> H5a[Ramsey RESET test]
    H5 --> H5b[‚ö†Ô∏è DacƒÉ RESPINS:<br/>adaugƒÉ termeni pƒÉtra»õi/<br/>forme func»õionale]
    
    H1 --> I[7. MODEL √éMBUNƒÇTƒÇ»öIT]
    H2 --> I
    H3 --> I
    H4 --> I
    H5 --> I
    
    I --> I1[FORME FUNC»öIONALE alternative]
    I1 --> I1a[Log-log: log VAT_GAP ~ log SHADOW]
    I1 --> I1b[Semi-log: VAT_GAP ~ log SHADOW]
    I1 --> I1c[PolinomialƒÉ: + SHADOW¬≤]
    
    I --> I2[INTERAC»öIUNI]
    I2 --> I2a[SHADOW √ó DIGI_DUMMY<br/>efectul digitalizƒÉrii modificƒÉ<br/>impactul economiei subterane?]
    
    I --> I3[ComparƒÉ modele cu AIC/BIC<br/>Alege modelul optim]
    
    I3 --> J[8. EVALUARE OUT-OF-SAMPLE]
    
    J --> J1[Predict pe TEST set]
    J --> J2[CalculeazƒÉ metrici:]
    J2 --> J2a[‚Ä¢ RMSE - Root Mean Squared Error]
    J2 --> J2b[‚Ä¢ MAE - Mean Absolute Error]
    J2 --> J2c[‚Ä¢ MAPE - Mean Absolute % Error]
    J2 --> J2d[‚Ä¢ R¬≤ pe test]
    
    J --> K[9. REGULARIZARE & ML]
    
    K --> K1[Ridge Œ± > 0]
    K --> K2[Lasso Œ± > 0]
    K --> K3[Elastic Net]
    K --> K4[Cross-validation pentru Œ± optim]
    
    K --> K5[ComparƒÉ:<br/>OLS vs Ridge vs Lasso]
    K5 --> K5a[Acurate»õe predictivƒÉ RMSE/MAE]
    K5 --> K5b[Interpretabilitate coeficien»õi]
    
    K --> L[10. OP»öIONAL: ML AVANSAT]
    L --> L1[Random Forest]
    L --> L2[Gradient Boosting]
    L --> L3[SVR]
    
    L --> M[11. SCENARIU PROGNOZƒÇ]
    
    M --> M1[Pe modelul optim validat]
    M --> M2[Scenarii ipotetic:]
    M2 --> M2a[Ce se √Ænt√¢mplƒÉ dacƒÉ<br/>shadow economy scade cu 10%?]
    M2 --> M2b[Impact digitalizare √Æn »õƒÉri<br/>fƒÉrƒÉ DIGI_DUMMY=1]
    
    M --> N[12. INTERPRETARE & DISCU»öII]
    
    N --> N1[Validare cu literaturƒÉ]
    N --> N2[Convergen»õe OLS vs ML]
    N --> N3[LimitƒÉri studiu]
    N --> N4[Direc»õii viitoare]
    
    style A fill:#e1f5ff,stroke:#333,stroke-width:2px
    style G3 fill:#fff4e1
    style H1c fill:#ffe1e1
    style H2d fill:#ffe1e1
    style H3c fill:#ffe1e1
    style H4d fill:#ffe1e1
    style H5b fill:#ffe1e1
    style I3 fill:#e1ffe1
    style K5 fill:#f0e1ff
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeDrawer()"></div>

    <div id="drawer">
        <div class="drawer-header">
            <h2 id="drawer-title">Node ID</h2>
            <button class="close-btn" onclick="closeDrawer()">&times;</button>
        </div>
        <div class="drawer-content">
            <div id="node-text" class="node-content-display">
                </div>
            <label for="user-notes" style="font-size: 0.9em; color: #777;">My Notes:</label>
            <textarea id="user-notes" placeholder="Write your observation regarding this step here..."></textarea>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            securityLevel: 'loose', // Needed for HTML parsing in nodes
            flowchart: { htmlLabels: true }
        });

        // Wait for mermaid to render the graph, then attach listeners
        // Since startOnLoad is true, we use a slight delay or MutationObserver. 
        // A simple interval check is robust for copy-paste solutions.
        
        let attempts = 0;
        const initInterval = setInterval(() => {
            const nodes = document.querySelectorAll('.node');
            if (nodes.length > 0) {
                clearInterval(initInterval);
                attachListeners(nodes);
            }
            attempts++;
            if(attempts > 50) clearInterval(initInterval); // Stop after 5s if fail
        }, 100);

        function attachListeners(nodes) {
            nodes.forEach(node => {
                // 1. Single Click: Toggle 'completed' class
                node.addEventListener('click', (e) => {
                    // Toggle the class
                    node.classList.toggle('completed');
                });

                // 2. Double Click: Open Drawer
                node.addEventListener('dblclick', (e) => {
                    e.stopPropagation(); // Stop bubbling
                    const nodeId = node.id;
                    
                    // Mermaid text extraction is tricky because of HTML labels.
                    // We try to grab the text content of the label div/span.
                    let content = "";
                    const label = node.querySelector('.nodeLabel');
                    if(label) content = label.innerText;

                    openDrawer(nodeId, content);
                });
            });
        }

        // Drawer Logic
        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('overlay');
        const drawerTitle = document.getElementById('drawer-title');
        const nodeTextDisplay = document.getElementById('node-text');
        const noteArea = document.getElementById('user-notes');

        // Simple in-memory storage for notes during the session
        const notesStorage = {}; 

        let currentActiveNodeId = null;

        function openDrawer(id, content) {
            // Save previous note if switching
            if(currentActiveNodeId) {
                notesStorage[currentActiveNodeId] = noteArea.value;
            }

            currentActiveNodeId = id;
            
            // Clean up ID for display (remove mermaid generated junk)
            const cleanId = id.split('-')[1] || id; 

            drawerTitle.textContent = "Step: " + cleanId;
            nodeTextDisplay.innerText = content;
            
            // Load existing note or empty
            noteArea.value = notesStorage[id] || "";

            drawer.classList.add('open');
            overlay.classList.add('active');
        }

        function closeDrawer() {
            // Save current note before closing
            if(currentActiveNodeId) {
                notesStorage[currentActiveNodeId] = noteArea.value;
            }
            drawer.classList.remove('open');
            overlay.classList.remove('active');
            currentActiveNodeId = null;
        }
    </script>
</body>
</html>